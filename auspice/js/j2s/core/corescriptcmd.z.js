(function(Y,Z,$,aa,ba,N,H,O,Q,R,I,S,T,ca,K,F,U,L,V,da,W,ea,fa,ga,ha,ia,ja,ka,la,z,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa,Ba,Ca,Da,Ea,Fa,Ga,Ha,Ia,Ja,Ka,La,k,X){N("JS");c$=R(function(){this.e=this.vwr=null;this.chk=!1;this.st=null;this.slen=0;Q(this,arguments)},JS,"ScriptExt");k(c$,"init",function(a){this.e=a;this.vwr=this.e.vwr;return this},"~O");k(c$,"atomExpressionAt",function(a){return this.e.atomExpressionAt(a)},"~N");k(c$,"checkLength",function(a){this.e.checkLength(a)},"~N");k(c$,"error",
function(a){this.e.error(a)},"~N");k(c$,"invArg",function(){this.e.invArg()});k(c$,"invPO",function(){this.error(23)});k(c$,"getShapeProperty",function(a,d){return this.e.getShapeProperty(a,d)},"~N,~S");k(c$,"paramAsStr",function(a){return this.e.paramAsStr(a)},"~N");k(c$,"centerParameter",function(a){return this.e.centerParameter(a)},"~N");k(c$,"floatParameter",function(a){return this.e.floatParameter(a)},"~N");k(c$,"getPoint3f",function(a,d){return this.e.getPoint3f(a,d)},"~N,~B");k(c$,"intParameter",
function(a){return this.e.intParameter(a)},"~N");k(c$,"isFloatParameter",function(a){switch(this.e.tokAt(a)){case 2:case 3:return!0}return!1},"~N");k(c$,"setShapeProperty",function(a,d,c){this.e.setShapeProperty(a,d,c)},"~N,~S,~O");k(c$,"showString",function(a){this.e.showString(a)},"~S");k(c$,"stringParameter",function(a){return this.e.stringParameter(a)},"~N");k(c$,"getToken",function(a){return this.e.getToken(a)},"~N");k(c$,"tokAt",function(a){return this.e.tokAt(a)},"~N");k(c$,"setShapeId",function(a,
d,c){c&&this.invArg();d=this.e.setShapeNameParameter(d).toLowerCase();this.setShapeProperty(a,"thisID",d);return d},"~N,~N,~B");k(c$,"getColorTrans",function(a,d,c,b){c=3.4028235E38;1766856708!=a.theTok&&--d;switch(this.tokAt(d+1)){case 603979967:d++;c=this.isFloatParameter(d+1)?a.getTranslucentLevel(++d):this.vwr.getFloat(570425354);break;case 1073742074:d++,c=0}a.isColorParam(d+1)?b[0]=a.getArgbParam(++d):1048587==this.tokAt(d+1)?(b[0]=0,a.iToken=d+1):3.4028235E38==c?this.invArg():b[0]=-2147483648;
return c},"JS.ScriptEval,~N,~B,~A");k(c$,"finalizeObject",function(a,d,c,b,e,f,g,j){e&&this.setShapeProperty(a,"set",f);-2147483648!=d&&this.e.setShapePropertyBs(a,"color",Integer.$valueOf(d),j);3.4028235E38!=c&&this.e.setShapeTranslucency(a,"","translucent",c,j);0!=b&&this.setShapeProperty(a,"scale",Integer.$valueOf(b));0<g&&(this.e.setMeshDisplayProperty(a,g,0)||this.invArg())},"~N,~N,~N,~N,~B,~O,~N,JU.BS");N("JS");O(["JS.ScriptExt"],"JS.CmdExt","java.lang.Boolean $.Float $.Long java.util.Hashtable JU.AU $.BS $.Base64 $.Lst $.M3 $.M4 $.Measure $.P3 $.P4 $.PT $.Quat $.SB $.V3 J.api.Interface J.atomdata.RadiusData J.c.STER $.VDW J.i18n.GT JM.Atom $.AtomCollection $.BondSet $.LabelToken JS.SV $.ScriptCompiler $.ScriptError $.ScriptEval $.ScriptInterruption $.ScriptMathProcessor $.ScriptParam $.T JU.BSUtil $.BoxInfo $.C $.Edge $.Elements $.Escape $.Logger $.Parser $.Point3fi JV.FileManager $.StateManager $.Viewer".split(" "),
function(){c$=V(JS,"CmdExt",JS.ScriptExt);T(c$,function(){W(this,JS.CmdExt,[])});X(c$,"dispatch",function(a,d,c){this.chk=this.e.chk;this.slen=this.e.slen;this.st=c;switch(a){case 4098:this.assign();break;case 135270423:this.cache();break;case 4102:this.calculate();break;case 4103:this.capture();break;case 4105:this.centerAt();break;case 135270405:this.compare();break;case 528395:this.console();break;case 4106:this.connect(1);break;case 1095766024:this.configuration();break;case 135270408:this.data();
break;case 1612189718:this.connect(0);break;case 4120:this.image();break;case 1052700:this.mapProperty();break;case 4126:this.minimize();break;case 1276121113:this.modulation();break;case 4130:this.mutate();break;case 4131:this.navigate();break;case 4133:case 135270418:case 1052714:this.plot(c);break;case 135270926:this.show();break;case 528443:this.stereo();break;case 1614417948:this.unitcell(d?2:1);break;case 135270422:return this.write(d?c:null);case 6:this.measure();break;case 21:this.polyhedra();
break;case 20:this.ellipsoid();break;case 4:this.struts()}return null},"~N,~B,~A");k(c$,"evalParallel",function(a,d){this.chk=this.e.chk;this.slen=this.e.slen;var c=(new JS.ScriptEval).setViewer(this.vwr);c.historyDisabled=!0;c.compiler=new JS.ScriptCompiler(this.vwr);c.sm=d;try{c.restoreScriptContext(a,!0,!1,!1),c.allowJSThreads=!1,c.dispatchCommands(!1,!1,!1)}catch(b){if(K(b,Exception))return this.e.vwr.setStringProperty("_errormessage",""+b),null==c.thisContext&&(JU.Logger.error("Error evaluating context "+
b),this.vwr.isJS||b.printStackTrace()),!1;throw b;}return!0},"JS.ScriptContext,JV.ShapeManager");k(c$,"getBitsetIdent",function(a,d,c,b,e,f){var g=!H(c,JM.BondSet);g&&(null==d?d=this.vwr.getStandardLabelFormat(0):0==d.length&&(d="%[label]"));var j=null==d?-1:d.indexOf("%"),h=2147483647!=e;if(null==a||this.chk||g&&0>j)return null==d&&(d=""),f?z(-1,[d]):d;var j=this.vwr.ms,A=0,m=j.getLabeler();c=g||!b?null:c.associatedAtoms;null==c&&(null!=d&&0<d.indexOf("%D"))&&(c=this.vwr.ms.getAtomIndices(a));b=
null==d||0==d.length;var p=g||b?null:JM.LabelToken.getBondLabelValues();d=b?null:g?m.compile(this.vwr,d,"\x00",null):m.compile(this.vwr,d,"\u0001",p);var l=h?1:JU.BSUtil.cardinalityOf(a),u=Array(l),n=new JU.P3;for(e=h?e:a.nextSetBit(0);0<=e;e=a.nextSetBit(e+1)){var k;g?k=b?j.at[e].getInfo():m.formatLabelAtomArray(this.vwr,j.at[e],d,"\x00",c,n):(k=j.bo[e],k=b?k.getIdentity():m.formatLabelBond(this.vwr,k,d,p,c,n));k=JU.PT.formatStringI(k,"#",A+1);u[A++]=k;if(h)break}return 1==l&&!f?u[0]:u},"JU.BS,~S,~O,~B,~N,~B");
k(c$,"getLoadSymmetryParams",function(a,d,c){var b=this.e;this.chk=b.chk;this.slen=b.slen;var e=null,f=this.tokAt(a);if(1048586==f||8==f)e=this.getPoint3f(a,!1),a=b.iToken+1,f=this.tokAt(a);switch(f){case 1073741938:case 1073742080:case 1095761926:case 1073742163:case 1073742114:case 1073742152:case 1614417948:null==e&&(e=JU.P3.new3(555,555,-1)),b.iToken=a-1}f=null;if(null!=e){c.put("lattice",e);a=b.iToken+1;d.append(" {"+I(e.x)+" "+I(e.y)+" "+I(e.z)+"}");a=this.checkPacked(a,c,d);1095761926==this.tokAt(a)&&
(c.put("centroid",Boolean.TRUE),d.append(" CENTROID"),a=this.checkPacked(++a,c,d));if(1073742163==this.tokAt(a)){var g;d.append(" SUPERCELL ");if(b.isPoint3f(++a)){g=this.getPoint3f(a,!1);if(g.x!=I(g.x)||g.y!=I(g.y)||g.z!=I(g.z)||1>g.x||1>g.y||1>g.z)b.iToken=a,this.invArg();a=b.iToken}else g=this.stringParameter(a);d.append(JU.Escape.e(g));c.put("supercell",g);a=this.checkPacked(++a,c,d)}g=0;1073742114==this.tokAt(a)&&(a++,g=this.floatParameter(a++),d.append(" range "+g));c.put("symmetryRange",Float.$valueOf(g));
g=null;g=-2147483648;1073742152==this.tokAt(a)&&(++a,g=JU.PT.rep(this.paramAsStr(a++),"''",'"'),d.append(" spacegroup "+JU.PT.esc(g)),g.equalsIgnoreCase("ignoreOperators")?g=-999:(0==g.length?(e=this.vwr.getCurrentUnitCell(),null!=e&&(g=e.getSpaceGroupName())):0<=g.indexOf(",")&&9>e.x&&(9>e.y&&0==e.z)&&(g+="#doNormalize=0"),c.put("spaceGroupName",g),g=-2));var j=null;if(1614417948==this.tokAt(a)){++a;0==b.optParameterAsString(a).length?(e=this.vwr.getCurrentUnitCell(),null!=e&&(j=e.getUnitCellAsArray(!0),
f=e.getCartesianOffset())):j=b.floatParameterSet(a,6,9);(null==j||6!=j.length&&9!=j.length)&&this.invArg();d.append(" unitcell {");for(a=0;a<j.length;a++)d.append((0==a?"":" ")+j[a]);d.append("}");c.put("unitcell",j);-2147483648==g&&(g=-1);a=b.iToken+1}-2147483648!=g&&c.put("spaceGroupIndex",Integer.$valueOf(g))}null!=f?b.coordinatesAreFractional=!1:1073742066==this.tokAt(a)&&(f=this.getPoint3f(++a,!0));null!=f&&(b.coordinatesAreFractional?(f.setT(b.fractionalPoint),c.put("unitCellOffsetFractional",
b.coordinatesAreFractional?Boolean.TRUE:Boolean.FALSE),d.append(" offset {"+f.x+" "+f.y+" "+f.z+"/1}")):d.append(" offset "+JU.Escape.eP(f)),c.put("unitCellOffset",f),a=b.iToken+1);return a},"~N,JU.SB,java.util.Map");k(c$,"checkPacked",function(a,d,c){switch(this.tokAt(a)){case 1073741938:var b=null,e=this.tokAt(++a);switch(e){case 1614417948:case 1679429641:break;default:this.e.isArrayParameter(a)?(b=this.e.getPointArray(a,-1,!1),a=this.e.iToken):(b=[],--a)}a++;if(this.e.chk)break;switch(e){case 1614417948:if(b=
this.vwr.getCurrentUnitCell(),null!=b){b=JU.BoxInfo.getUnitCellPoints(b.getUnitCellVerticesNoOffset(),b.getCartesianOffset());break}case 1679429641:b=JU.BoxInfo.getUnitCellPoints(this.vwr.ms.getBBoxVertices(),null)}switch(b.length){case 2:e=b[1];b=z(-1,[b[0],JU.P3.newP(b[0]),new JU.P3,new JU.P3,new JU.P3]);b[1].x=e.x;b[2].y=e.y;b[3].z=e.z;break;case 3:b=z(-1,[new JU.P3,b[0],b[1],b[2]]);break;case 4:break;default:b=z(-1,[new JU.P3,JU.P3.new3(10,0,0),JU.P3.new3(0,10,0),JU.P3.new3(0,0,10)])}d.put("fillRange",
b);c.append(" FILL ["+b[0]+b[1]+b[2]+b[3]+"]");break;case 1073742080:b=NaN,this.isFloatParameter(++a)&&(b=this.floatParameter(a++)),this.e.chk||(d.put("packed",Boolean.TRUE),c.append(" PACKED"),Float.isNaN(b)||(d.put("packingError",Float.$valueOf(b)),c.append(" "+b)))}return a},"~N,java.util.Map,JU.SB");k(c$,"cache",function(){var a=this.tokAt(1),d=null,c=2;switch(a){case 1276118017:case 1073742119:d=this.e.optParameterAsString(c++);case 1073741882:this.checkLength(c);this.chk||("all".equals(d)&&
(d=null),d=this.vwr.cacheFileByName(d,1276118017==a),this.showString(0>d?"cache cleared":d+" bytes "+(1276118017==a?" cached":" removed")));break;default:this.invArg()}});k(c$,"calculate",function(){var a=!1,d=!1,c=null,b=null,e=this.e,f=-2147483648;if(2<=(e.iToken=e.slen))switch(e.clearDefinedVariableAtomSets(),this.getToken(1).tok){case 1073741824:this.checkLength(2);break;case 1632634891:this.checkLength(2);if(this.chk)return;f=this.vwr.calculateFormalCharges(null);this.showString(J.i18n.GT.i(J.i18n.GT._("{0} charges modified"),
f));return;case 1076887572:this.checkLength(2);this.chk||this.vwr.ms.assignAromaticBondsBs(!0,null);return;case 1612189718:2!=e.slen&&(c=(d=1641025539==this.tokAt(++e.iToken))?this.vwr.bsA():this.atomExpressionAt(e.iToken),!d&&1641025539!=this.tokAt(++e.iToken)&&(b=this.atomExpressionAt(e.iToken)));if(this.chk)return;f=this.vwr.autoHbond(c,b,!1);-2147483648!=f&&e.report(J.i18n.GT.i(J.i18n.GT._("{0} hydrogen bonds"),Math.abs(f)));return;case 1613758476:c=2==this.slen?null:this.atomExpressionAt(2);
e.checkLast(e.iToken);this.chk||this.vwr.addHydrogens(c,!1,!1);return;case 1112541195:e.iToken=1;c=2==this.slen?null:this.atomExpressionAt(2);e.checkLast(e.iToken);if(!this.chk)try{this.vwr.calculatePartialCharges(c)}catch(g){if(K(g,JV.JmolAsyncException))e.loadFileResourceAsync(g.getFileName());else throw g;}return;case 1073742102:this.chk||this.showString(this.vwr.ms.calculatePointGroup(this.vwr.bsA()));return;case 1112539150:this.checkLength(2);this.chk||(this.vwr.calculateStraightness(),this.vwr.addStateScript("set quaternionFrame '"+
this.vwr.getQuaternionFrame()+"'; calculate straightness",!1,!0));return;case 1641025539:c=4>this.slen?null:this.atomExpressionAt(2);switch(this.tokAt(++e.iToken)){case 1052714:break;case 1073741916:if(this.chk)return;e.showString(this.vwr.getAnnotationParser().calculateDSSRStructure(this.vwr,c));return;case 1073741915:d=!0;break;case 0:d=this.vwr.getBoolean(603979826);break;default:this.invArg()}this.chk||this.showString(this.vwr.calculateStructures(c,d,!0));return;case 1708058:c=e.iToken+1<this.slen?
this.atomExpressionAt(++e.iToken):null;b=e.iToken+1<this.slen?this.atomExpressionAt(++e.iToken):null;this.checkLength(++e.iToken);this.chk||(f=this.vwr.calculateStruts(c,b),0<f&&(this.setShapeProperty(1,"type",Integer.$valueOf(32768)),e.setShapePropertyBs(1,"color",Integer.$valueOf(16777215),null),e.setShapeTranslucency(1,"","translucent",0.5,null),this.setShapeProperty(1,"type",Integer.$valueOf(1023))),this.showString(J.i18n.GT.i(J.i18n.GT._("{0} struts added"),f)));return;case 3145756:a=!0;case 1112539151:d=
!1;switch(this.tokAt(2)){case 135266325:e.iToken++;break;case 0:d=!a;break;case 1073741952:d=!0;e.iToken++;break;default:d=!0}c=e.iToken+1<this.slen?this.atomExpressionAt(++e.iToken):this.vwr.bsA();this.checkLength(++e.iToken);this.chk||this.vwr.calculateSurface(c,d?3.4028235E38:-1);return}e.errorStr2(53,"CALCULATE","aromatic? hbonds? hydrogen? formalCharge? partialCharge? pointgroup? straightness? structure? struts? surfaceDistance FROM? surfaceDistance WITHIN?")});k(c$,"capture",function(){if(!this.chk&&
!this.vwr.allowCapture())this.showString("Cannot capture on this platform");else{var a=this.vwr.captureParams,d=null==a?"GIF":a.get("type"),c=0,b=0,e=this.e.slen,f="",g=1073742070!=this.vwr.am.animationReplayMode,j=1,h=this.tokAt(j),A=603979967==h;A&&(h=this.tokAt(++j));switch(0==h?h=1150985:h){case 4:f=this.e.optParameterAsString(j++);if(0==f.length){b=1150985;break}d=f.toLowerCase();d.endsWith(".gift")||d.endsWith(".pngt")?(A=!0,f=f.substring(0,f.length-1),d=f.toLowerCase()):!d.endsWith(".gif")&&
!d.contains(".png")&&(f+=".gif");d.endsWith(".png")?(d.endsWith("0.png")||(f=f.substring(0,f.length-4)+"0000.png"),d="PNG"):d="GIF";A&&(d+="T");a=f.indexOf("0000.");h=0>a||a!=f.lastIndexOf(".")-4;a=!1;528411==this.tokAt(j)&&(g=!0,this.tokAt(++j));switch(this.tokAt(j)){case 1073742129:a=!0;case 1611141175:c=null;g="y";j++;a?(j<e&&2!=this.tokAt(j)&&(g=this.e.optParameterAsString(j++).toLowerCase()),c=JU.PT.rep("rotate Y 10 10;rotate Y -10 -10;rotate Y -10 -10;rotate Y 10 10","10",""+(j<e?this.intParameter(j++):
5))):(j<e&&(g=this.e.optParameterAsString(j++).toLowerCase()),c="rotate Y 360 30;");if(this.chk)return;this.vwr.setNavigationMode(!1);if(""===g||0>"xyz".indexOf(g))g="y";e=this.vwr.g.waitForMoveTo;c="set waitformoveto true;"+JU.PT.rep(c,"Y",g)+";set waitformoveto "+e;c="capture "+(A?"transparent ":"")+JU.PT.esc(f)+" LOOP;"+c+";capture end;";this.e.cmdScript(0,null,c);return;case 3:case 2:c=this.floatParameter(j++)}if(this.chk)return;b=1073742032;a=new java.util.Hashtable;A=this.vwr.getInt(553648132);
h&&(a.put("streaming",Boolean.TRUE),g||this.showString(J.i18n.GT.o(J.i18n.GT._("Note: Enable looping using {0}"),z(-1,["ANIMATION MODE LOOP"]))),this.showString(J.i18n.GT.o(J.i18n.GT._("Animation delay based on: {0}"),z(-1,["ANIMATION FPS "+A]))));a.put("captureFps",Integer.$valueOf(A));break;case 1150985:case 1073741874:null!=a&&a.put("captureSilent",Boolean.TRUE);case 1048589:case 1048588:this.checkLength(-2);b=h;break;default:this.invArg()}this.chk||null==a||(a.put("type",d),A=Integer.$valueOf(this.vwr.getBackgroundArgb()),
a.put("backgroundColor",A),a.put("fileName",f),a.put("quality",Integer.$valueOf(-1)),a.put("endTime",Long.$valueOf(0>=c?-1:System.currentTimeMillis()+S(1E3*c))),a.put("captureMode",JS.T.nameOf(b).toLowerCase()),a.put("captureLooping",g?Boolean.TRUE:Boolean.FALSE),f=this.vwr.processWriteOrCapture(a),null==f&&(f="canceled"),JU.Logger.info(f))}});k(c$,"centerAt",function(){var a=this.getToken(1).tok;switch(a){case 1073741826:case 96:case 1679429641:break;default:this.invArg()}var d=JU.P3.new3(0,0,0);
5==this.slen?(d.x=this.floatParameter(2),d.y=this.floatParameter(3),d.z=this.floatParameter(4)):this.e.isCenterParameter(2)?(d=this.centerParameter(2),this.e.checkLast(this.e.iToken)):this.checkLength(2);!this.chk&&!this.vwr.isJmolDataFrame()&&this.vwr.tm.setCenterAt(a,d)});k(c$,"compare",function(){var a=this.e,d=!1,c=!1,b=!1,e=!1,f=!1,g=null,j=null,h=null,A=null,m=null,p=null;a.iToken=0;var l=this.isFloatParameter(1)?this.floatParameter(++a.iToken):NaN,k=this.atomExpressionAt(++a.iToken),n=null,
x=null;a.isArrayParameter(++a.iToken)?n=a.getPointArray(a.iToken,-1,!1):1141899265!=this.tokAt(a.iToken)&&(x=this.atomExpressionAt(a.iToken));var t=null,s=!1,B=null,y=JU.BSUtil.copy(k);null!=x&&y.or(x);for(var y=e=null==n&&null!=x&&y.equals(k),q=a.iToken+1;q<this.slen;++q)switch(this.getToken(q).tok){case 4115:y=!0;break;case 135267336:if(s=!0,4!=this.tokAt(q+1)){B="*";break}case 135267335:B=this.stringParameter(++q);break;case 1678770178:c=f=!0;B=this.paramAsStr(++q);B.equalsIgnoreCase("SMILES")&&
(s=!0,B="*");break;case 3:case 2:l=Math.abs(this.floatParameter(q));break;case 269484080:break;case 3158024:t=this.atomExpressionAt(++q);q=a.iToken;break;case 10:case 1048577:null!=p&&this.invArg();var h=this.atomExpressionAt(a.iToken),E=e?0:this.tokAt(a.iToken+1),A=null==n&&a.isArrayParameter(a.iToken+1)?null:10==E||1048577==E?this.atomExpressionAt(++a.iToken):JU.BSUtil.copy(h);null!=t&&(h.and(t),null!=A&&A.and(t));null==A?n=a.getPointArray(++a.iToken,-1,!1):A.and(x);null==m&&(m=new JU.Lst);m.addLast(z(-1,
[h,A]));q=a.iToken;break;case 7:null!=m&&this.invArg();d=!0;g=a.getQuaternionArray(a.theToken.getList(),1073742001);this.getToken(++q);j=a.getQuaternionArray(a.theToken.getList(),1073742001);null==p&&(p=new JU.Lst);p.addLast(z(-1,[g,j]));break;case 1073742077:d=!0;break;case 135266320:case 1141899265:d=!1;break;case 528432:c=!0;break;case 4160:b=!0;break;default:this.invArg()}if(!this.chk){y&&(l=0);Float.isNaN(l)||0>l?l=1:!c&&!b&&(c=b=!0);e=0!=l;(E=!d&&null==B||null!=n)&&J.api.Interface.getInterface("JU.Eigen",
this.vwr,"script");null==m&&null==p&&(null==t?(h=E?this.vwr.getAtomBitSet("spine"):new JU.BS,0>h.nextSetBit(0)?(h=k,A=x):(A=JU.BSUtil.copy(h),h.and(k),A.and(x))):(h=JU.BSUtil.copy(k),A=JU.BSUtil.copy(x),h.and(t),A.and(t),h.and(k),A.and(x)),m=new JU.Lst,m.addLast(z(-1,[h,A])));if(y){k=this.vwr.ms.getModelBS(k,!1);t=Array(k.cardinality());q=0;for(A=k.nextSetBit(0);0<=A;A=k.nextSetBit(A+1),q++)t[q]=this.vwr.getModelUndeletedAtomsBitSet(A)}else t=z(-1,[k]);for(A=0;A<t.length;A++){for(var k=t[A],w=L(2,
0),r=null,v=new JU.Lst,C=null,D=y?new JU.Lst:m,q=0;q<m.size();++q){var M=m.get(q);y&&D.addLast(M=z(-1,[JU.BSUtil.copy(M[0]),M[1]]));M[0].and(k)}var G=null,F=null;if(E){null!=n&&(D.clear(),D.addLast(z(-1,[h,n])));try{C=this.vwr.getCenterAndPoints(D,!0)}catch(I){if(K(I,Exception))this.invArg();else throw I;}r=C[0].length-1;for(q=1;q<=r;q++){v=C[0][q];M=C[1][q];if(!H(v,JM.Atom)||!H(M,JM.Atom))break;JU.Logger.info(" atom 1 "+v.getInfo()+"\tatom 2 "+M.getInfo())}r=JU.Measure.calculateQuaternionRotation(C,
w);q=Float.isNaN(w[1])?NaN:Math.round(100*w[0])/100;w=Float.isNaN(w[1])?NaN:Math.round(100*w[1])/100;this.showString("RMSD "+q+" --\x3e "+w+" Angstroms")}else if(d){if(null==p)for(q=0;q<D.size();q++){M=D.get(q);g=this.vwr.getAtomGroupQuaternions(M[0],2147483647);j=this.vwr.getAtomGroupQuaternions(M[1],2147483647);for(r=0;r<g.length&&r<j.length;r++)v.addLast(j[r].div(g[r]))}else for(r=0;r<g.length&&r<j.length;r++)v.addLast(j[r].div(g[r]));w[0]=0;g=v.toArray(Array(v.size()));r=JU.Quat.sphereMean(g,
w,1E-4);this.showString("RMSD = "+w[0]+" degrees")}else{q=new JU.M4;G=new JU.P3;if(("*".equals(B)||"".equals(B))&&null!=k)try{B=this.vwr.getSmiles(k)}catch(P){if(K(P,Exception))a.evalError(P.getMessage(),null);else throw P;}if(f){var N;if(null==k||null==x||null==(N=a.getSmilesExt().getFlexFitList(k,x,B,!s)))break;this.vwr.setDihedrals(N,null,1)}w=a.getSmilesExt().getSmilesCorrelation(k,x,B,null,null,q,null,!s,!1,null,G,!1,!1);if(Float.isNaN(w)){this.showString("structures do not match");break}b&&
(F=new JU.V3,q.getTranslation(F));c&&(r=new JU.M3,q.getRotationScale(r),r=JU.Quat.newM(r));this.showString("RMSD = "+w+" Angstroms")}null!=C&&(G=C[0][0]);null==G&&(C=this.vwr.getCenterAndPoints(D,!0),G=C[0][0]);D=new JU.P3;w=NaN;b&&(null==F&&(F=JU.V3.newVsub(C[1][0],G)),w=1E10);c&&(null==r&&a.evalError("option not implemented",null),D.add2(G,r.getNormal()),w=r.getTheta(),0==w&&b&&(0.01<F.length()?w=1E10:c=b=e=!1));if(!Float.isNaN(w)&&!Float.isNaN(D.x)&&(C=null,c&&(b&&0!=l)&&(C=this.vwr.ms.getAtomPointVector(k),
q=JS.ScriptMathProcessor.getMatrix4f(r.getMatrix(),F),C=JU.Measure.transformPoints(C,q,G)),a.useThreads()||(e=!1),this.vwr.rotateAboutPointsInternal(a,G,D,w/l,w,e,k,F,C,null,null)&&e&&a.isJS))throw new JS.ScriptInterruption(a,"compare",1);}}});k(c$,"configuration",function(){var a=null,d=this.vwr.bsA();if(1==this.slen){if(this.chk)return;a=this.vwr.ms.setConformation(d);this.vwr.ms.addStateScript("select",null,d,null,"configuration",!0,!1)}else if(this.isFloatParameter(1)){d=this.intParameter(this.e.checkLast(1));
if(this.chk)return;a=this.vwr.ms.getConformation(this.vwr.am.cmi,d-1,!0,null);this.vwr.addStateScript("configuration "+d+";",!0,!1)}else a=this.atomExpressionAt(1),d=this.intParameter(this.e.checkLast(this.e.iToken+1)),this.vwr.addStateScript("configuration "+a+" "+d+";",!0,!1),a=this.vwr.ms.getConformation(this.vwr.am.cmi,d-1,!0,a);this.setShapeProperty(1,"type",Integer.$valueOf(30720));this.e.setShapeSizeBs(1,0,a);this.vwr.autoHbond(a,a,!0);this.vwr.select(a,!1,0,this.e.tQuiet)});k(c$,"measure",
function(){var a=this.e,d=null,c=0,b=null;if(2==this.slen)switch(this.tokAt(1)){case 1048588:this.setShapeProperty(6,"hideAll",Boolean.TRUE);return;case 12291:this.chk||this.vwr.clearAllMeasurements();return}this.vwr.shm.loadShape(6);switch(this.tokAt(1)){case 135267335:var e=this.stringParameter(3==this.slen?2:4);if(this.chk)return;var f=this.vwr.ms.at,d=this.vwr.ms.ac,c=null;try{c=this.vwr.getSmilesMatcher().getCorrelationMaps(e,f,d,this.vwr.bsA(),!0,!1)}catch(g){if(K(g,Exception))a.evalError(g.getMessage(),
null);else throw g;}if(null==c)return;this.setShapeProperty(6,"maps",c);return}switch(this.slen){case 2:switch(this.getToken(1).tok){case 0:case 1048589:this.vwr.shm.loadShape(6);this.setShapeProperty(6,"hideAll",Boolean.FALSE);return;case 1073742001:this.chk||a.showStringPrint(this.vwr.getMeasurementInfoAsString(),!1);return;case 4:this.setShapeProperty(6,"setFormats",this.stringParameter(1));return}a.errorStr(24,"ON, OFF, DELETE");break;case 3:switch(this.getToken(1).tok){case 12291:if(1048579==
this.getToken(2).tok)this.chk||this.vwr.clearAllMeasurements();else{var j=this.intParameter(2)-1;this.chk||this.vwr.deleteMeasurement(j)}return}}for(var h=0,k=0,m=-1,p=-1,l=-1,u=F(5,0),n=L(-1,[3.4028235E38,3.4028235E38]),x=!1,t=!1,s=!1,B=!0,y=null,q=null,e=269484114,E=f=null,w=new JU.Lst,r=new JU.BS,v=null,C=null,D=0,z=0,j=1;j<this.slen;++j)switch(this.getToken(j).tok){case 1074790550:1!=j&&this.invArg();d=a.optParameterAsString(++j);continue;case 1073741824:a.errorStr(24,"ALL, ALLCONNECTED, DELETE");
break;default:this.error(15);break;case 269484144:135266310!=this.tokAt(j+1)&&this.invArg();j++;s=!0;break;case 135266310:case 1073741834:case 1048579:t=1073741834==a.theTok;p=-1;x=!0;t&&s&&this.invArg();break;case 1766856708:c=JU.C.getColix(a.getArgbParam(++j));j=a.iToken;break;case 1073742066:a.isPoint3f(++j)?(b=this.getPoint3f(j,!1),b=L(-1,[1,b.x,b.y,b.z,0,0,0])):b=a.floatParameterSet(j,7,7);j=a.iToken;break;case 1666189314:case 1073741917:z=I((1666189314==a.theTok?2E3:1E3)*this.floatParameter(++j));
null!=d&&0>=z&&(z=-1);break;case 3:null!=y&&this.invArg();B=x=!0;l=(l+1)%2;n[l]=this.floatParameter(j);break;case 12291:269484114!=e&&this.invArg();e=12291;break;case 4114:var G=this.floatParameter(++j),N=this.paramAsStr(++j),O=this.paramAsStr(++j);this.chk||(E=this.vwr.getFont3D(N,O,G));break;case 2:G=this.intParameter(j);if(x)B=!0,l=(l+1)%2,n[l]=G;else{p=this.vwr.ms.getFirstAtomIndexFromAtomNumber(G,this.vwr.getVisibleFramesBitSet());if(!this.chk&&0>p)return;null!=v&&this.invArg();4<(u[0]=++h)&&
a.bad();u[h]=p}break;case 1095761935:m=this.intParameter(++j);break;case 1048588:269484114!=e&&this.invArg();e=1048588;break;case 1048589:269484114!=e&&this.invArg();e=1048589;break;case 1073742114:B=x=!0;p=-1;break;case 1073741989:case 1073741990:q=Boolean.$valueOf(1073741989==a.theTok);x=!0;s=1073741990==a.theTok;break;case 1649412120:0<=l&&this.invArg();y=a.encodeRadiusParameter(j,!1,!0);if(null==y)return;y.values=n;j=a.iToken;x=s=!0;q=Boolean.$valueOf(!1);1==D&&(D++,h++,G=JU.BSUtil.copy(r),JU.BSUtil.invertInPlace(G,
this.vwr.ms.ac),G.and(this.vwr.ms.getAtomsWithinRadius(5,r,!1,null)),w.addLast(G));break;case 10:case 1048577:case 1048586:case 8:case 1048582:(10==a.theTok||1048577==a.theTok)&&D++;0<=p&&this.invArg();a.expressionResult=Boolean.FALSE;v=this.centerParameter(j);if(H(a.expressionResult,JU.BS)&&(v=r=a.expressionResult,!this.chk&&0==r.length()))return;H(v,JU.P3)&&(h=new JU.Point3fi,h.setT(v),h.mi=m,v=h);4<(h=++k)&&a.bad();j=a.iToken;w.addLast(v);break;case 4:f=this.stringParameter(j);break;case 1073742164:C=
a.tickParamAsStr(j,!1,!0,!0),j=a.iToken,e=1060866}(null!=y&&(0<=l||2!=h)||2>h&&null==d&&(null==C||1==h))&&a.bad();null!=f&&0!=f.indexOf(h+":")&&(f=h+":"+f);B&&n[1]<n[0]&&(n[1]=n[0],n[0]=3.4028235E38==n[1]?3.4028235E38:-200);if(!this.chk)if(null!=v||null!=C)null==y&&(y=new J.atomdata.RadiusData(n,0,null,null)),null==v&&(C.id="default"),null!=v&&(null!=f&&269484114==e)&&(e=1060866),a=null,null!=E&&(a=J.api.Interface.getInterface("JM.Text",this.vwr,"script").newLabel(this.vwr,E,"",c,0,0,0,null)),null!=
a&&(a.pymolOffset=b),this.setShapeProperty(6,"measure",this.vwr.newMeasurementData(d,w).set(e,null,y,f,null,C,t,s,q,x,z,c,a));else switch(a=null==d?u:d,e){case 12291:this.setShapeProperty(6,"delete",a);break;case 1048589:this.setShapeProperty(6,"show",a);break;case 1048588:this.setShapeProperty(6,"hide",a);break;default:this.setShapeProperty(6,null==f?"toggle":"toggleOn",a),null!=f&&this.setShapeProperty(6,"setFormats",f)}});k(c$,"connect",function(a){var d=this.e,c=L(2,0),b=Array(2);b[0]=b[1]=this.vwr.bsA();
var e=NaN,f=F(-1,[-2147483648]),g=0,j=131071,h=1073742026,k=!1,m=!1,p=!1,l=3.4028235E38,u=!1,n=0,x=0,t=new JU.BS,s=!1,B=0,y=0,q=0,E=!1;if(1==this.slen)this.chk||this.vwr.rebondState(d.$isStateScript);else{for(;a<this.slen;++a){switch(this.getToken(a).tok){case 1048589:case 1048588:this.checkLength(2);this.chk||this.vwr.rebondState(d.$isStateScript);return;case 2:case 3:if(0<n){(m||u)&&d.error(23);j=JU.Edge.getBondOrderFromFloat(this.floatParameter(a));131071==j&&this.invArg();m=!0;break}2<++x&&d.bad();
var w=this.floatParameter(a);269484210==this.tokAt(a+1)&&(w=-w/100,a++);c[g++]=w;break;case 10:case 1048577:(2<n||s&&0<n)&&d.bad();(m||u)&&this.invArg();b[n++]=this.atomExpressionAt(a);s=d.isBondSet;if(2==n){for(var w=d.iToken,r=a;r<w;r++)if(1073741824==this.tokAt(r)&&this.paramAsStr(r).equals("_1")){B=a;break}d.iToken=w}a=d.iToken;break;case 1087373318:E=!0;break;case 1766856708:case 603979967:case 1073742074:u=!0;l=this.getColorTrans(d,a,!1,f);a=d.iToken;break;case 1074790662:f=1073741852==this.tokAt(2);
this.checkLength(f?3:2);if(this.chk)return;this.vwr.clearModelDependentObjects();this.vwr.ms.deleteAllBonds();e=new JU.BS;this.vwr.ms.setPdbConectBonding(0,0,e);if(f){d=d.$isStateScript&&this.vwr.getBoolean(603979873);this.vwr.ms.autoBondBs4(null,null,e,null,this.vwr.getMadBond(),d);this.vwr.addStateScript(d?"set legacyAutoBonding TRUE;connect PDB AUTO;set legacyAutoBonding FALSE;":"connect PDB auto;",!1,!0);return}this.vwr.addStateScript("connect PDB;",!1,!0);return;case 1073741830:case 1073741852:case 1073741904:case 1073742025:case 1073742026:p=
!0;++a!=this.slen&&this.invArg();h=d.theTok;1073741852==h&&!(131071==j||2048==j||515==j)&&this.invArg();break;case 1708058:u||(f[0]=16777215,l=0.5,e=this.vwr.getFloat(570425406),u=!0),p||(h=1073742026),p=!0;case 1073741824:if(d.isColorParam(a)){y=-a;break}case 1076887572:case 1612189718:j=this.paramAsStr(a);131071==(j=JS.ScriptParam.getBondOrderFromString(j))&&this.invArg();m&&d.error(18);m=!0;switch(j){case 33:switch(this.tokAt(a+1)){case 3:j=JS.ScriptParam.getPartialBondOrderFromFloatEncodedInt(this.st[++a].intValue);
break;case 2:j=this.intParameter(++a)}break;case 2048:2==this.tokAt(a+1)&&(j=this.intParameter(++a)<<11,q=this.floatParameter(++a))}break;case 1666189314:e=this.floatParameter(++a);u=!0;break;case 1048587:case 12291:++a!=this.slen&&this.invArg();h=12291;k=!0;u=!1;break;default:y=a}0<a&&(y==-a||y==a&&d.isColorParam(a)?(u=!0,f[0]=d.getArgbParam(a),a=d.iToken):y==a&&this.invArg())}if(!this.chk){2>g&&(0==g&&(c[0]=1E8),c[1]=c[0],c[0]=0.1);u&&(m||(j=65535),p||(h=1073742025));m=g=0;if(0<B){q=new JU.BS;this.vwr.definedAtomSets.put("_1",
q);E=b[0];for(p=E.nextSetBit(0);0<=p;p=E.nextSetBit(p+1))q.set(p),b=this.vwr.makeConnections(c[0],c[1],j,h,q,this.atomExpressionAt(B),t,s,!1,0),g+=Math.abs(b[0]),m+=b[1],q.clear(p)}else b=this.vwr.makeConnections(c[0],c[1],j,h,b[0],b[1],t,s,E,q),g+=Math.abs(b[0]),m+=b[1];c=d.doReport();k?c&&d.report(J.i18n.GT.i(J.i18n.GT._("{0} connections deleted"),m)):(u&&(this.vwr.selectBonds(t),Float.isNaN(e)||d.setShapeSizeBs(1,Math.round(2E3*e),null),this.finalizeObject(1,f[0],l,0,!1,null,0,t),this.vwr.selectBonds(null)),
c&&d.report(J.i18n.GT.o(J.i18n.GT._("{0} new bonds; {1} modified"),z(-1,[Integer.$valueOf(g),Integer.$valueOf(m)]))))}}},"~N");k(c$,"console",function(){switch(this.getToken(1).tok){case 1048588:this.chk||this.vwr.showConsole(!1);break;case 1048589:this.chk||this.vwr.showConsole(!0);break;case 1073741882:this.chk||this.vwr.sm.clearConsole();break;case 135270422:this.showString(this.stringParameter(2));break;default:this.invArg()}});k(c$,"data",function(){var a=this.e,d=null,c=null,b=!1,e;switch(a.iToken=
this.slen){case 5:d=this.paramAsStr(2);case 4:case 2:c=this.paramAsStr(1);if(c.equalsIgnoreCase("clear")){this.chk||this.vwr.setData(null,null,0,0,0,0,0);return}if(0<=(e=c.indexOf("@")))d=""+a.getParameter(c.substring(e+1),4,!0),c=c.substring(0,e).trim();else if(null==d&&0<=(e=c.indexOf(" ")))d=c.substring(e+1).trim(),c=c.substring(0,e).trim(),b=!0;break;default:a.bad()}e=c+" ";e=e.substring(0,e.indexOf(" ")).toLowerCase();if(e.equals("model")||e.equals("append"))a.cmdLoad();else if(!this.chk){var f=
0<=c.toLowerCase().indexOf("(default)");if(e.equals("connect_atoms"))this.vwr.ms.connect(this.parseDataArray(d,!1));else if(0==e.indexOf("ligand_"))this.vwr.setLigandModel(c.substring(7).toUpperCase()+"_data",d.trim());else if(0==e.indexOf("file_"))this.vwr.setLigandModel(c.substring(5)+"_file",d.trim());else if(a=Array(4),e.equals("element_vdw")){a[0]=e;a[1]=d.$replace(";","\n");d=JU.Elements.elementNumberMax;e=F(d+1,0);for(f=1;f<=d;f++)e[f]=f;a[2]=e;a[3]=Integer.$valueOf(0);this.vwr.setData("element_vdw",
a,d,0,0,0,0)}else if(0==e.indexOf("data2d_"))a[0]=c,a[1]=this.parseDataArray(d,!1),a[3]=Integer.$valueOf(2),this.vwr.setData(c,a,0,0,0,0,0);else if(0==e.indexOf("data3d_"))a[0]=c,a[1]=this.parseDataArray(d,!0),a[3]=Integer.$valueOf(3),this.vwr.setData(c,a,0,0,0,0,0);else{var g=JU.PT.getTokens(c);if(0==e.indexOf("property_")&&!(2==g.length&&g[1].equals("set"))){f=this.vwr.bsA();a[0]=e;var j=b?0:this.vwr.getP("propertyAtomNumberField").intValue(),h=b?0:this.vwr.getP("propertyAtomNumberColumnCount").intValue(),
k=b?-2147483648:this.vwr.getP("propertyDataField").intValue(),m=b?0:this.vwr.getP("propertyDataColumnCount").intValue();!b&&0<=c.indexOf(" ")&&(3==g.length&&(j=JU.PT.parseInt(g[1]),k=JU.PT.parseInt(g[2])),5==g.length&&(j=JU.PT.parseInt(g[1]),h=JU.PT.parseInt(g[2]),k=JU.PT.parseInt(g[3]),m=JU.PT.parseInt(g[4])));0>j&&(j=0);0>k&&(k=0);c=this.vwr.ms.ac;b=null;g=JU.BS.newN(c);if(0<j){for(var b=F(c+2,0),p=0;p<=c;p++)b[p]=-1;for(p=f.nextSetBit(0);0<=p;p=f.nextSetBit(p+1)){var l=this.vwr.ms.at[p].getAtomNumber();
l>c+1||(0>l||g.get(l))||(g.set(l),b[l]=p)}a[2]=b}else a[2]=JU.BSUtil.copy(f);a[1]=d;a[3]=Integer.$valueOf(0);this.vwr.setData(e,a,c,j,h,k,m)}else"occupany".equals(e)&&(e="occupancy"),j=JM.AtomCollection.getUserSettableType(e),0<=j?this.vwr.setAtomData(j,e,d,f):(a[0]=c,a[1]=d,a[3]=Integer.$valueOf(0),this.vwr.setData(e,a,0,0,0,0,0))}}});k(c$,"ellipsoid",function(){var a=this.e,d=0,c=1,b=3.4028235E38,e=!1,f=!1;this.setShapeProperty(20,"thisID",null);switch(this.getToken(1).tok){case 1048589:d=2147483647;
break;case 1048588:break;case 2:d=this.intParameter(1);break;case 1085443:this.e.sm.loadShape(20);this.setShapeProperty(20,"select",this.paramAsStr(2));c=a.iToken;f=e=!0;break;case 1074790550:case 269484209:case 1073741824:this.e.sm.loadShape(20);1074790550==a.theTok&&c++;this.setShapeId(20,c,!1);c=a.iToken;e=!0;break;default:this.invArg()}if(e){for(d=F(-1,[-2147483648]);++c<this.slen;){var e=this.paramAsStr(c),g=null;this.getToken(c);if(!f)switch(a.theTok){case 1048582:e="points";g=Array(3);g[0]=
a.objectNameParameter(++c);if(this.chk)continue;a.getShapePropertyData(24,"getVertices",g);break;case 1611272194:for(var g=Array(3),j=0;3>j;j++)g[j]=new JU.V3,g[j].setT(this.centerParameter(++c)),c=a.iToken;break;case 12289:g=this.centerParameter(++c);c=a.iToken;break;case 1095761935:g=Integer.$valueOf(this.intParameter(++c));break;case 12291:g=Boolean.TRUE,this.checkLength(c+1)}if(null==g)switch(a.theTok){case 1048589:e="on";g=Boolean.TRUE;break;case 1048588:e="on";g=Boolean.FALSE;break;case 1073742138:g=
Float.$valueOf(this.floatParameter(++c));break;case 10:case 1048577:e="atoms";g=this.atomExpressionAt(c);c=a.iToken;break;case 1766856708:case 603979967:case 1073742074:b=this.getColorTrans(a,c,!0,d);c=a.iToken;continue;case 1073742075:g=this.paramAsStr(++c)}null==g&&this.invArg();this.setShapeProperty(20,e.toLowerCase(),g)}this.finalizeObject(20,d[0],b,0,!1,null,0,null);this.setShapeProperty(20,"thisID",null)}else a.setShapeSizeBs(20,d,null)});k(c$,"image",function(){this.chk||this.vwr.getConsole();
var a=1,d=null;1074790550==this.tokAt(1)&&(d=this.e.optParameterAsString(++a),a++);var c=this.e.optParameterAsString(a),b=this.e.optParameterAsString(this.slen-1).equalsIgnoreCase("close");if(!b&&(this.slen==a||this.slen==a+2))c=this.slen==a+2?this.intParameter(a++):-1,a=0>c?-1:this.intParameter(a),b=new java.util.Hashtable,b.put("fileName","\u0001\u0001"+d),b.put("backgroundColor",Integer.$valueOf(this.vwr.getBackgroundArgb())),b.put("type","png"),b.put("quality",Integer.$valueOf(-1)),b.put("width",
Integer.$valueOf(c)),b.put("height",Integer.$valueOf(a)),this.chk||this.vwr.processWriteOrCapture(b);else{if(b)switch(this.slen){case 2:c="closeall";break;case 3:case 4:break;default:this.checkLength(0)}this.chk||this.vwr.fm.loadImage(b?"\u0001close":c,"\u0001"+c+"\u0001"+("".equals(d)||null==d?null:d))}});k(c$,"mapProperty",function(){for(var a,d,c,b,e,f=0,g=0,j=0,h=this.e;;){if(1114638363==this.tokAt(1))a=this.vwr.bsA(),d=this.atomExpressionAt(2),c=b="selected";else{a=this.atomExpressionAt(1);if(1048583!=
this.tokAt(++h.iToken)||!JS.T.tokAttr(f=this.tokAt(++h.iToken),1078984704))break;c=this.paramAsStr(h.iToken);d=this.atomExpressionAt(++h.iToken);if(1048583!=this.tokAt(++h.iToken)||!JS.T.tokAttr(g=this.tokAt(++h.iToken),2048))break;b=this.paramAsStr(h.iToken)}e=JS.T.tokAttr(j=this.tokAt(h.iToken+1),1078984704)?this.paramAsStr(++h.iToken):JS.T.nameOf(j=1095763969);h.checkLast(h.iToken);if(this.chk)return;var k=null;this.showString("mapping "+c.toUpperCase()+" for "+a.cardinality()+" atoms to "+b.toUpperCase()+
" for "+d.cardinality()+" atoms using "+e.toUpperCase());if(JS.T.tokAttrOr(f,1095761920,1112539136)&&JS.T.tokAttrOr(g,1095761920,1112539136)&&JS.T.tokAttrOr(j,1095761920,1112539136)){var m=h.getBitsetPropertyFloat(a,f|224,NaN,NaN),p=h.getBitsetPropertyFloat(a,j|224,NaN,NaN),f=h.getBitsetPropertyFloat(d,j|224,NaN,NaN),l=1716520985==g,u=L(l?this.vwr.ms.ac:f.length,0),k=new JU.BS;if(m.length==p.length){for(var n=new java.util.Hashtable,j=0;j<m.length;j++)n.put(Float.$valueOf(p[j]),Float.$valueOf(m[j]));
m=-1;for(j=p=0;j<f.length;j++){var m=d.nextSetBit(m+1),x=n.get(Float.$valueOf(f[j]));null!=x&&(k.set(m),u[l?m:p]=x.floatValue(),p++)}l?this.vwr.setData(b,z(-1,[b,u,k,Integer.$valueOf(1),Boolean.TRUE]),this.vwr.ms.ac,0,0,2147483647,0):this.vwr.setAtomProperty(k,g,0,0,null,u,null)}}if(null==k){c=this.getBitsetIdent(a,"{"+e+"=%["+e+"]}."+b+" = %["+c+"]",null,!1,2147483647,!1);a=new JU.SB;for(j=0;j<c.length;j++)0>c[j].indexOf("null")&&a.append(c[j]).appendC("\n");JU.Logger.debugging&&JU.Logger.debug(a.toString());
c=JU.BSUtil.copy(this.vwr.slm.bsSubset);this.vwr.slm.setSelectionSubset(d);try{h.runScript(a.toString())}catch(t){if(K(t,Exception))d=t,this.vwr.slm.setSelectionSubset(c),h.errorStr(-1,"Error: "+d.getMessage());else if(K(t,Error))d=t,this.vwr.slm.setSelectionSubset(c),h.errorStr(-1,"Error: "+d.toString());else throw t;}this.vwr.slm.setSelectionSubset(c)}this.showString("DONE");return}this.invArg()});k(c$,"minimize",function(){for(var a=null,d=2147483647,c=0,b=!1,e=!1,f=null,g=!1,j=this.vwr.getMinimizer(!1),
h=1;h<this.slen;h++)switch(this.getToken(h).tok){case 1073741828:b=!0;continue;case 1073741874:case 1073742162:this.checkLength(2);if(this.chk||null==j)return;j.setProperty(this.paramAsStr(h),null);return;case 1073741882:this.checkLength(2);if(this.chk||null==j)return;j.setProperty("clear",null);return;case 1073741894:1!=h&&this.invArg();d=a=0;c=F(5,0);if(1073741882==this.tokAt(++h))this.checkLength(3);else{for(;4>a&&!this.isFloatParameter(h);)c[++a]=this.atomExpressionAt(h).nextSetBit(0),h=this.e.iToken+
1;c[0]=a;1==a&&this.invArg();d=this.floatParameter(this.e.checkLast(h))}this.chk||this.vwr.getMinimizer(!0).setProperty("constraint",z(-1,[c,F(a,0),Float.$valueOf(d)]));return;case 1073741905:c=this.floatParameter(++h);continue;case 1073741934:d=0;continue;case 1060869:1!=h&&this.invArg();f=this.atomExpressionAt(++h);0>f.nextSetBit(0)&&(f=null);h=this.e.iToken;this.chk||this.vwr.getMinimizer(!0).setProperty("fixed",f);if(h+1==this.slen)return;continue;case 10:case 1048577:g=!0;case 135280133:135280133==
this.e.theTok&&h++;a=this.atomExpressionAt(h);h=this.e.iToken;1073742072==this.tokAt(h+1)&&(h++,g=!0);continue;case 1073742148:e=!0;break;case 266298:d=this.intParameter(++h);continue;default:this.invArg()}if(!this.chk)try{this.vwr.minimize(this.e,d,c,a,f,0,b,g,e,!1)}catch(k){if(K(k,Exception))throw new JS.ScriptInterruption(this.e,"minimize",1);throw k;}});k(c$,"modulation",function(){var a=null,d=this.e,c=!0,b=!1,e=null,f=1;switch(this.getToken(f).tok){case 1048588:c=!1;case 0:case 1048589:break;
case 10:case 1048577:e=this.atomExpressionAt(1);switch(this.tokAt(d.iToken+1)){case 1048588:c=!1;case 1048589:d.iToken++}d.checkLast(d.iToken);break;case 1048586:case 8:a=d.getPoint3f(1,!1);b=1048589==this.tokAt(d.iToken+1);break;case 1073741824:var g=d.theToken.value.toString();f++;g.equalsIgnoreCase("t")?d.theTok=3:g.equalsIgnoreCase("m")||g.equalsIgnoreCase("q")?d.theTok=2:this.invArg();case 3:case 2:switch(d.theTok){case 3:this.isFloatParameter(f)?(a=this.floatParameter(f),a=JU.P3.new3(a,a,a)):
a=d.getPoint3f(f,!1);break;case 2:2==this.tokAt(f)?(b=this.intParameter(f),a=JU.P3.new3(b,b,b)):a=d.getPoint3f(f,!1),b=!0}break;case 1073742138:c=this.floatParameter(2);this.chk||this.vwr.setFloatProperty("modulationScale",c);return;default:this.invArg()}this.chk||(this.vwr.tm.setVibrationPeriod(0),this.vwr.setModulation(e,c,a,b))});k(c$,"mutate",function(){var a,d;switch(this.tokAt(1)){case 2:this.st[1]=JS.T.o(4,""+this.st[1].value);default:a=this.atomExpressionAt(1);d=++this.e.iToken;break;case 269484209:a=
this.vwr.getAllAtoms(),d=2}a.and(this.vwr.getModelUndeletedAtomsBitSet(this.vwr.ms.mc-1));var c=a.length()-1;if(!(0>c||this.vwr.ms.at[c].mi+1!=this.vwr.ms.mc||this.vwr.ms.isTrajectory(this.vwr.ms.at[c].mi)))if(c=this.e.optParameterAsString(d),this.e.checkLast(d),!this.chk&&this.vwr.ms.am[this.vwr.ms.mc-1].isBioModel){var b=null;if(4==this.tokAt(d)&&!c.startsWith("~"))b=z(-1,[c]),c=null;else{c=JU.PT.replaceAllCharacters(c,",; \t\n"," ").trim().toUpperCase();if((d=c.startsWith("~"))||3!=c.length||!this.vwr.getJBR().isKnownPDBGroup(c,
20))c=this.vwr.getJBR().toStdAmino3(d?c.substring(1):c);b=JU.PT.getTokens(c)}0<b.length&&this.vwr.ms.bioModelset.mutate(a,c,b)}});k(c$,"navigate",function(){var a=this.e;if(1==this.slen)a.setBooleanProperty("navigationMode",!0);else{var d=JU.V3.new3(0,1,0),c=new JU.Lst,b;if(2==this.slen)switch(this.getToken(1).tok){case 1048589:case 1048588:if(this.chk)return;a.setObjectMad(34,"axes",1);this.setShapeProperty(34,"position",JU.P3.new3(50,50,3.4028235E38));a.setBooleanProperty("navigationMode",!0);this.vwr.tm.setNavOn(1048589==
a.theTok);return;case 1073742162:this.chk||this.vwr.tm.setNavXYZ(0,0,0);return;case 8:case 1113200654:break;default:this.invArg()}!this.chk&&!this.vwr.getBoolean(603979888)&&a.setBooleanProperty("navigationMode",!0);for(var e=1;e<this.slen;e++){var f=this.isFloatParameter(e)?this.floatParameter(e++):2;0>f&&this.invArg();!this.chk&&0<f&&a.refresh(!1);switch(this.getToken(e).tok){case 8:case 1048586:b=this.getPoint3f(e,!0);a.iToken++;a.iToken!=this.slen&&this.invArg();this.chk||this.vwr.tm.setNavXYZ(b.x,
b.y,b.z);return;case 554176526:b=this.floatParameter(++e);this.chk||c.addLast(z(-1,[Integer.$valueOf(554176526),Float.$valueOf(f),Float.$valueOf(b)]));continue;case 12289:b=this.centerParameter(++e);e=a.iToken;this.chk||c.addLast(z(-1,[Integer.$valueOf(135266320),Float.$valueOf(f),b]));continue;case 528432:switch(this.getToken(++e).tok){case 1112541205:d.set(1,0,0);e++;break;case 1112541206:d.set(0,1,0);e++;break;case 1112541207:d.set(0,0,1);e++;break;case 8:case 1048586:d.setT(this.getPoint3f(e,
!0));e=a.iToken+1;break;case 1073741824:this.invArg()}b=this.floatParameter(e);this.chk||c.addLast(z(-1,[Integer.$valueOf(528432),Float.$valueOf(f),d,Float.$valueOf(b)]));continue;case 4160:var g=b=NaN;if(this.isFloatParameter(++e))b=this.floatParameter(e),g=this.floatParameter(++e);else switch(this.tokAt(e)){case 1112541205:b=this.floatParameter(++e);break;case 1112541206:g=this.floatParameter(++e);break;default:b=this.centerParameter(e);e=a.iToken;this.chk||c.addLast(z(-1,[Integer.$valueOf(4160),
Float.$valueOf(f),b]));continue}this.chk||c.addLast(z(-1,[Integer.$valueOf(269484210),Float.$valueOf(f),Float.$valueOf(b),Float.$valueOf(g)]));continue;case 269484208:continue;case 1113200654:b=new JU.Lst;10==this.tokAt(e+1)||1048577==this.tokAt(e+1)?(g=this.atomExpressionAt(++e),e=a.iToken):g=this.vwr.bsA();if(this.chk)return;this.vwr.getPolymerPointsAndVectors(g,b);var j;if(0<(j=b.size())){for(var g=Array(j),h=0;h<j;h++)g[h]=b.get(h);c.addLast(z(-1,[Integer.$valueOf(1113200654),Float.$valueOf(f),
g]));continue}break;case 1073742084:if(1048582==this.getToken(e+1).tok){e++;b=a.objectNameParameter(++e);if(this.chk)return;this.setShapeProperty(22,"thisID",b);b=this.getShapeProperty(22,"vertices");a.refresh(!1);null==b&&this.invArg();g=I(this.isFloatParameter(e+1)?this.floatParameter(++e):0);j=I(this.isFloatParameter(e+1)?this.floatParameter(++e):2147483647);c.addLast(z(-1,[Integer.$valueOf(1073742084),Float.$valueOf(f),b,null,F(-1,[g,j])]));continue}for(b=new JU.Lst;a.isCenterParameter(e+1);)b.addLast(this.centerParameter(++e)),
e=a.iToken;if(0<b.size()){b=b.toArray(Array(b.size()));this.chk||c.addLast(z(-1,[Integer.$valueOf(1073742084),Float.$valueOf(f),b,null,F(-1,[0,2147483647])]));continue}default:this.invArg()}}!this.chk&&!this.vwr.isJmolDataFrame()&&this.vwr.tm.navigateList(a,c)}});k(c$,"plot",function(a){var d=this.e,c=this.vwr.am.cmi;0>c&&d.errorStr(30,"plot");var c=this.vwr.ms.getJmolDataSourceFrame(c),b=a.length-1,e=a!==this.st,f=!0,g=this.st;e&&(d.st=this.st=a);var j=e?135270926:a[0].tok,h=e||135270418==j||1052714==
j?0:1,k=null,m=!0,p=!1;switch(j){case 135176:m=!1;p=!0;break;case 135270926:f=m=!1;break;case 135270422:m=!1,4==JS.CmdExt.tokAtArray(b,a)?k=this.stringParameter(b--):1048583==JS.CmdExt.tokAtArray(b-1,a)?(k=this.paramAsStr(b-2)+"."+this.paramAsStr(b),b-=3):(d.st=this.st=g,d.iToken=this.st.length,this.error(13))}var e="",l=null,u="",n=!1,x=!1,t=!1,s=!1,B=0,y=0,q=0,E=JU.BSUtil.copy(this.vwr.bsA()),w="; select "+JU.Escape.eBS(E)+";\n ",s=d.optParameterAsString(b).toLowerCase(),r=null,v=null,C=null,D=
JS.CmdExt.tokAtArray(h,a);4==D&&(D=JS.T.getTokFromName(a[h].value));switch(D){default:d.iToken=1;this.invArg();break;case 135270408:d.iToken=1;s="data";w="";break;case 1716520985:d.iToken=h+1;B=this.plotProp();0==B&&this.invArg();y=this.plotProp();q=this.plotProp();1288701959==this.tokAt(d.iToken)&&(C=this.stringParameter(++d.iToken),f=!1,d.iToken++);32==this.tokAt(d.iToken)&&(r=this.getPoint3f(++d.iToken,!1),d.iToken++);64==this.tokAt(d.iToken)&&(v=this.getPoint3f(++d.iToken,!1),d.iToken++);s="property "+
JS.T.nameOf(B)+(0==y?"":" "+JS.T.nameOf(y))+(0==q?"":" "+JS.T.nameOf(q));0>E.nextSetBit(0)&&(E=this.vwr.getModelUndeletedAtomsBitSet(c));u="select "+JU.Escape.eBS(E)+";\n ";break;case 1052714:s.equalsIgnoreCase("draw")&&(s=d.optParameterAsString(--b).toLowerCase());s=b>h&&s.startsWith("r");s="ramachandran"+(s?" r":"")+(135176==j?" draw":"");break;case 135270418:case 137363467:e=' "'+this.vwr.getQuaternionFrame()+'"';u="set quaternionFrame"+e+";\n  ";n=!0;s.equalsIgnoreCase("draw")&&(p=!0,s=d.optParameterAsString(--b).toLowerCase());
t=(x=s.startsWith("deriv")||s.startsWith("diff"))&&0<s.indexOf("2");x&&b--;if(s.equalsIgnoreCase("helix")||s.equalsIgnoreCase("axis"))x=p=!0,b=-1;s=((b<=h?"":d.optParameterAsString(b))+"w").substring(0,1);if(s.equals("a")||s.equals("r"))x=!0;JU.PT.isOneOf(s,";w;x;y;z;r;a;")||d.evalError("QUATERNION [w,x,y,z,a,r] [difference][2]",null);s="quaternion "+s+(x?" difference":"")+(t?"2":"")+(p?" draw":"")}this.st=g;if(this.chk)return"";if(m&&(u+="plot "+s,a=this.vwr.ms.getJmolDataFrameIndex(c,u),0<a&&135270422!=
j&&135270926!=j))return this.vwr.setCurrentModelIndexClear(a,!0),"";g=b=a=null;if(1716520985==D){a=d.getBitsetPropertyFloat(E,B|224,null==r?NaN:r.x,null==v?NaN:v.x);0!=y&&(b=d.getBitsetPropertyFloat(E,y|224,null==r?NaN:r.y,null==v?NaN:v.y));0!=q&&(g=d.getBitsetPropertyFloat(E,q|224,null==r?NaN:r.z,null==v?NaN:v.z));null==r&&(r=JU.P3.new3(this.getPlotMinMax(a,!1,B),this.getPlotMinMax(b,!1,y),this.getPlotMinMax(g,!1,q)));null==v&&(v=JU.P3.new3(this.getPlotMinMax(a,!0,B),this.getPlotMinMax(b,!0,y),this.getPlotMinMax(g,
!0,q)));JU.Logger.info("plot min/max: "+r+" "+v);h=l=null;if(f){h=JU.P3.new3(1,1,1);l=new JU.P3;l.ave(v,r);h.sub2(v,r);h.set(h.x/200,h.y/200,h.z/200);JS.T.tokAttr(B,1095761920)?(h.x=1,l.x=0):0.1<h.x&&10>=h.x&&(h.x=1);JS.T.tokAttr(y,1095761920)?(h.y=1,l.y=0):0.1<h.y&&10>=h.y&&(h.y=1);JS.T.tokAttr(q,1095761920)?(h.z=1,l.z=0):0.1<h.z&&10>=h.z&&(h.z=1);if(0==q||0==y)l.z=r.z=v.z=h.z=0;for(f=0;f<a.length;f++)a[f]=(a[f]-l.x)/h.x;if(0!=y)for(f=0;f<b.length;f++)b[f]=(b[f]-l.y)/h.y;if(0!=q)for(f=0;f<g.length;f++)g[f]=
(g[f]-l.z)/h.z}l=z(-1,[E,a,b,g,r,v,h,l,C])}if(135270422==j)return this.vwr.writeFileData(k,"PLOT_"+s,c,l);f=s.equals("data")?"1 0 H 0 0 0 # Jmol PDB-encoded data":this.vwr.getPdbData(c,s,null,l,null,!0);if(135270926==j)return f;JU.Logger.debugging&&JU.Logger.debug(f);if(135176==j)return d.runScript(f),"";j=this.vwr.fm.getFileInfo();k=this.vwr.getBoolean(603979792);this.vwr.g.appendNew=!0;f=null!=f&&null==this.vwr.openStringInlineParamsAppend(f,null,!0);this.vwr.g.appendNew=k;this.vwr.fm.setFileInfo(j);
if(!f)return"";j=this.vwr.ms.mc;this.vwr.ms.setJmolDataFrame(u,c,j-1);1716520985!=D&&(u+=";\n"+w);u=this.vwr.addStateScript(u,!0,!1);f=150;switch(D){default:c="frame 0.0; frame last; reset;select visible;wireframe only;";f=10;break;case 1716520985:this.vwr.setFrameTitle(j-1,s+" plot for model "+this.vwr.getModelNumberDotted(c));c="frame 0.0; frame last; reset;select visible; spacefill 3; wireframe 0;draw plotAxisX"+j+' {100 -100 -100} {-100 -100 -100} "'+JS.T.nameOf(B)+'";draw plotAxisY'+j+' {-100 100 -100} {-100 -100 -100} "'+
JS.T.nameOf(y)+'";';0!=q&&(c+="draw plotAxisZ"+j+' {-100 -100 100} {-100 -100 -100} "'+JS.T.nameOf(q)+'";');break;case 1052714:this.vwr.setFrameTitle(j-1,"ramachandran plot for model "+this.vwr.getModelNumberDotted(c));c="frame 0.0; frame last; reset;select visible; color structure; spacefill 3.0; wireframe 0;draw ramaAxisX"+j+' {100 0 0} {-100 0 0} "phi";draw ramaAxisY'+j+' {0 100 0} {0 -100 0} "psi";';break;case 135270418:case 137363467:this.vwr.setFrameTitle(j-1,s.$replace("w"," ")+e+" for model "+
this.vwr.getModelNumberDotted(c)),c=JU.C.getHexCode(this.vwr.cm.colixBackgroundContrast),c="frame 0.0; frame last; reset;select visible; wireframe 0; spacefill 3.0; isosurface quatSphere"+j+" color "+c+" sphere 100.0 mesh nofill frontonly translucent 0.8;draw quatAxis"+j+'X {100 0 0} {-100 0 0} color red "x";draw quatAxis'+j+'Y {0 100 0} {0 -100 0} color green "y";draw quatAxis'+j+'Z {0 0 100} {0 0 -100} color blue "z";color structure;draw quatCenter'+j+"{0 0 0} scale 0.02;"}d.runScript(c+w);u.setModelIndex(this.vwr.am.cmi);
this.vwr.setRotationRadius(f,!0);d.sm.loadShape(31);this.showString("frame "+this.vwr.getModelNumberDotted(j-1)+(0<s.length?" created: "+s+(n?e:""):""));return""},"~A");k(c$,"plotProp",function(){var a=0;switch(this.tokAt(this.e.iToken)){case 1288701959:case 32:case 64:break;default:JS.T.tokAttr(a=this.tokAt(this.e.iToken),1078984704)&&this.e.iToken++}return a});k(c$,"polyhedra",function(){var a=this.e,d=!1,c=!1,b=!1,e=!1,f=!1,g=0,j=0;this.e.sm.loadShape(21);this.setShapeProperty(21,"init",Boolean.TRUE);
for(var h="centers",k="radius_",m=3.4028235E38,p=F(-1,[-2147483648]),l=1;l<this.slen;++l){var u=null,n=null;switch(this.getToken(l).tok){case 12291:case 1048589:case 1048588:(l+1!=this.slen||d||1<j||0==j&&"to".equals(h))&&this.error(18);u=1048588==a.theTok?"off":1048589==a.theTok?"on":"delete";c=!0;break;case 269484436:case 269484080:continue;case 1678770178:0<j&&this.invPO();d=!0;u="bonds";break;case 1666189314:k="radius";continue;case 2:case 3:0<j&&!f&&this.invPO();if(2==a.theTok&&"radius_"===k){u=
"nVertices";n=Integer.$valueOf(this.intParameter(l));d=!0;break}u="radius_"===k?"radius":k;n=Float.$valueOf(this.floatParameter(l));k="radius_";f=!1;d=!0;break;case 10:case 1048577:b&&this.invPO();2<++j&&a.bad();"to".equals(h)&&(d=!0);u=h;h="to";n=this.atomExpressionAt(l);l=a.iToken;break;case 1074790746:1<j&&this.invPO();if(10==this.tokAt(l+1)||1048577==this.tokAt(l+1)&&!d){u="toBitSet";n=this.atomExpressionAt(++l);l=a.iToken;d=!0;break}else d||this.error(19);h="to";continue;case 1073741937:d||this.error(19);
k="faceCenterOffset";f=!0;continue;case 1073741924:0==j&&this.error(19);k="distanceFactor";f=!0;continue;case 1766856708:case 603979967:case 1073742074:m=this.getColorTrans(a,l,!0,p);l=a.iToken;continue;case 1073741886:case 1073741948:u="collapsed";n=1073741886==a.theTok?Boolean.TRUE:Boolean.FALSE;b&&this.error(18);b=!0;break;case 1073742044:case 1073741933:case 1073741956:e&&this.error(18);u=this.paramAsStr(l);e=!0;break;case 1073741964:g=a.theTok;continue;default:if(a.isColorParam(l)){p[0]=a.getArgbParam(l);
l=a.iToken;continue}this.invArg()}this.setShapeProperty(21,u,n);if(c)return!1}!d&&(!b&&!e&&0==g)&&this.error(19);d&&this.setShapeProperty(21,"generate",null);-2147483648!=p[0]&&this.setShapeProperty(21,"colorThis",Integer.$valueOf(p[0]));3.4028235E38!=m&&a.setShapeTranslucency(21,"","translucentThis",m,null);0!=g&&this.setShapeProperty(21,"token",Integer.$valueOf(g));this.setShapeProperty(21,"init",Boolean.FALSE);return!0});k(c$,"write",function(a){var d=this.e,c=1,b=1,e=null,f=null,g=null,j=null,
h="SPT",k=!0,m=!1;null==a?(a=this.st,m=this.vwr.isApplet&&!this.vwr.isSignedApplet||!this.vwr.haveAccess(JV.Viewer.ACCESS.ALL)||0<this.vwr.fm.getPathForAllFiles().length):(c=b=0,k=!1,m=!k);var p=JS.CmdExt.tokAtArray(c,a);if(4==p&&!k){var l=JS.T.getTokenFromName(JS.SV.sValue(a[0]).toLowerCase());null!=l&&(p=l.tok)}switch(p){case 0:break;case 135270418:case 1052714:case 1716520985:return f=this.plot(a),m?f:this.writeMsg(f);case 135271429:d.isArrayParameter(c+1)&&(e=d.stringParameterSet(++c),j=g=".",
b=c=d.iToken+1,p=this.tokAt(c));break;default:h=JS.SV.sValue(this.tokenAt(c,a)).toUpperCase()}var u=this.vwr.getExportDriverList(),l=null,n=k?this.slen:a.length,x="",t=null,s=null,B=0,y="PNGJ",q=!1,z=null,w=-1,r=-1,v=!1,f=null;0!=p&&(k&&1<this.slen&&1073741848==this.tokAt(this.slen-2))&&(h=this.paramAsStr(this.slen-1).toUpperCase(),b=n,n-=2,p=0);switch(p){case 15:case 6:h="VAR";s=this.tokenAt(c++,a);break;case 1073741983:h="INLINE";l=JS.SV.sValue(this.tokenAt(++c,a));c++;break;case 1073742102:h="PGRP";
c++;x=JS.SV.sValue(this.tokenAt(c,a)).toLowerCase();x.equals("draw")&&c++;break;case 1048581:c++;q=!0;break;case 1073742158:case 135271429:for(t=JS.SV.sValue(this.tokenAt(++c,a)).toLowerCase();t.equals("localpath")||t.equals("remotepath");)t.equals("localpath")?g=JS.SV.sValue(this.tokenAt(++c,a)):j=JS.SV.sValue(this.tokenAt(++c,a)),t=JS.SV.sValue(this.tokenAt(++c,a)).toLowerCase();h="SPT";break;case 1229984263:case 135368713:case 1610616855:case 135180:case 1073742015:case 1073742018:case 1073877011:case 1073877010:case 135188:c++;
break;case 1073741991:h="ZIPALL";c++;break;case 36868:h="VAR";c+=2;break;case 4115:case 4120:case 1073742139:case 4166:case 1073741824:case 4:switch(p){case 4115:var C;c+1<n&&1048577==a[++c].tok||10==a[c].tok?(C=d.atomExpression(a,c,0,!0,!1,!0,!0),c=d.iToken+1):C=this.vwr.getAllAtoms();this.chk||(z=this.vwr.ms.getModelBS(C,!0));break;case 4120:h="IMAGE";c++;break;case 1073742139:t=JS.SV.sValue(this.tokenAt(++c,a)).toUpperCase();JU.PT.isOneOf(t,";PNG;PNGJ;")&&(y=t,c++);break;case 4166:B=d.intParameterRange(++c,
1,10);if(2147483647==B)return"";this.chk||(this.vwr.tm.setVibrationPeriod(0),d.isJS||d.delayScript(100));c++;break;default:p=4120}if(4120==p&&c<a.length)if(p=JS.T.getTokenFromName(JS.SV.sValue(a[c]).toLowerCase()),null!=p&&(h=JS.SV.sValue(p).toUpperCase()),JU.PT.isOneOf(h,u.toUpperCase())){c++;h=h.substring(0,1).toUpperCase()+h.substring(1).toLowerCase();v=!0;k&&(f="Jmol."+h.toLowerCase());break}else if(JU.PT.isOneOf(h,";ZIP;ZIPALL;SPT;STATE;")){c++;break}else h="IMAGE";2==JS.CmdExt.tokAtArray(c,
a)&&(w=JS.SV.iValue(this.tokenAt(c++,a)),r=JS.SV.iValue(this.tokenAt(c++,a)))}p=-2147483648;if(b<n){t=JS.SV.sValue(this.tokenAt(c,a));if(t.equalsIgnoreCase("clipboard")){if(this.chk)return""}else JU.PT.isOneOf(t.toLowerCase(),";jpg;jpeg;jpg64;jpeg64;gif;gift;pdf;ppm;png;pngj;pngt;")?(2==JS.CmdExt.tokAtArray(c+1,a)&&2==JS.CmdExt.tokAtArray(c+2,a)&&(w=JS.SV.iValue(this.tokenAt(++c,a)),r=JS.SV.iValue(this.tokenAt(++c,a))),2==JS.CmdExt.tokAtArray(c+1,a)&&(p=JS.SV.iValue(this.tokenAt(++c,a)))):JU.PT.isOneOf(t.toLowerCase(),
";xyz;xyzrn;xyzvib;mol;sdf;v2000;v3000;json;pdb;pqr;cml;")&&(h=t.toUpperCase(),c+1==n&&c++);h.equals("IMAGE")&&JU.PT.isOneOf(t.toLowerCase(),";jpg;jpeg;jpg64;jpeg64;gif;gift;pdf;ppm;png;pngj;pngt;scene;")&&(h=t.toUpperCase(),c++)}c+2==n&&(n=JS.SV.sValue(this.tokenAt(++c,a)),0<n.length&&"."!=n.charAt(0)&&(h=t.toUpperCase()));switch(JS.CmdExt.tokAtArray(c,a)){case 0:m=!0;break;case 1073741884:break;case 806354977:f=h.equals("IMAGE")?"?jmol.png":"?jmol."+h.toLowerCase();break;case 1073741824:case 4:f=
JS.SV.sValue(this.tokenAt(c,a));if(f.equalsIgnoreCase("clipboard")||!this.vwr.haveAccess(JV.Viewer.ACCESS.ALL))f=null;break;default:this.invArg()}if(h.equals("IMAGE")||h.equals("FRAME")||h.equals("VIBRATION"))h=null!=f&&0<=f.indexOf(".")?f.substring(f.lastIndexOf(".")+1).toUpperCase():"JPG";t=JU.PT.isOneOf(h.toLowerCase(),";jpg;jpeg;jpg64;jpeg64;gif;gift;pdf;ppm;png;pngj;pngt;scene;");if(!t&&(h.equals("MNU")?h="MENU":h.equals("WRL")||h.equals("VRML")?(h="Vrml",v=!0):h.equals("X3D")?(h="X3d",v=!0):
h.equals("IDTF")?(h="Idtf",v=!0):h.equals("MA")?(h="Maya",v=!0):h.equals("JS")?(h="Js",v=!0):h.equals("OBJ")?(h="Obj",v=!0):h.equals("JVXL")?h="ISOSURFACE":h.equals("XJVXL")?h="ISOSURFACE":h.equals("JMOL")?h="ZIPALL":h.equals("HIS")&&(h="HISTORY"),h.equals("COORD")||h.equals("COORDS")))h=null!=f&&0<=f.indexOf(".")?f.substring(f.lastIndexOf(".")+1).toUpperCase():"XYZ";null!=e&&(h.equals("PNG")&&(h="PNGJ"),!h.equals("PNGJ")&&(!h.equals("ZIPALL")&&!h.equals("ZIP"))&&this.invArg());!t&&(!v&&!JU.PT.isOneOf(h,
";SCENE;JMOL;ZIP;ZIPALL;SPT;HISTORY;MO;NBO;ISOSURFACE;MESH;PMESH;VAR;FILE;FUNCTION;CML;JSON;XYZ;XYZRN;XYZVIB;MENU;MOL;PDB;PGRP;PQR;QUAT;RAMA;SDF;V2000;V3000;INLINE;"))&&d.errorStr2(54,"COORDS|FILE|FUNCTIONS|HISTORY|IMAGE|INLINE|ISOSURFACE|JMOL|MENU|MO|NBO|POINTGROUP|QUATERNION [w,x,y,z] [derivative]|RAMACHANDRAN|SPT|STATE|VAR x|ZIP|ZIPALL  CLIPBOARD","CML|GIF|GIFT|JPG|JPG64|JMOL|JVXL|MESH|MOL|PDB|PMESH|PNG|PNGJ|PNGT|PPM|PQR|SDF|CD|JSON|V2000|V3000|SPT|XJVXL|XYZ|XYZRN|XYZVIB|ZIP"+u.toUpperCase().$replace(";",
"|"));if(this.chk)return"";c=Array(1);b=this.vwr.getBoolean(603979934);if(v){b&&JU.Logger.startTimer("export");e=new java.util.Hashtable;e.put("type",h);null!=f&&e.put("fileName",f);(k||null!=f)&&e.put("fullPath",c);e.put("width",Integer.$valueOf(w));e.put("height",Integer.$valueOf(r));l=this.vwr.generateOutputForExport(e);if(null==l||0==l.length)return"";if(m)return l;if(!h.equals("Povray")&&!h.equals("Idtf")||null==c[0])return this.writeMsg(l);e=h.equals("Idtf")?".tex":".ini";f=c[0]+e;m=new java.util.Hashtable;
m.put("fileName",f);m.put("type",e);m.put("text",l);m.put("fullPath",c);f=this.vwr.processWriteOrCapture(m);h.equals("Idtf")&&(l=l.substring(0,l.indexOf("\\begin{comment}")));l="Created "+c[0]+":\n\n"+l;b&&this.showString(JU.Logger.getTimerMsg("export",0));null!=f&&(f.startsWith("OK")||d.evalError(f,null),d.report(l));return""}n=null;v=!1;if(null==l){u=0;l=h.intern();if("MENU"===l)l=this.vwr.getMenu("");else if("PGRP"===l)l=this.vwr.ms.getPointGroupAsString(this.vwr.bsA(),x.equals("draw"),null,0,
1);else if("PDB"===l||"PQR"===l)m?l=this.vwr.getPdbAtomData(null,null,"PQR"===l,q):(v=!0,h="PDB_"+l+"-coord "+q);else if("FILE"===l)"?".equals(f)&&(f="?Jmol."+this.vwr.getP("_fileType")),m?l=this.vwr.getCurrentFileAsString("script"):v=!0;else if("SDF"===l||"MOL"===l||"V2000"===l||"V3000"===l||"CD"===l||"JSON"===l||"XYZ"===l||"XYZRN"===l||"XYZVIB"===l||"CML"===l)l=this.vwr.getModelExtract("selected",q,!1,l),l.startsWith("ERROR:")&&(n=l);else if("FUNCTION"===l)l=this.vwr.getFunctionCalls(null),h="TXT";
else if("VAR"===l){null==s&&(s=d.getParameter(JS.SV.sValue(this.tokenAt(k?2:1,a)),1073742190,!0));a=null;if(15==s.tok)a=new JU.Lst,a.addLast(s.value.data);else if(6==s.tok&&(g=s.value,g.containsKey("$_BINARY_$")&&(a=new JU.Lst,null!=f)))for(var D,g=g.entrySet().iterator();g.hasNext()&&((D=g.next())||1);)if(j=D.getKey(),!j.equals("$_BINARY_$"))if(x=D.getValue(),n=15==x.tok?x.value.data:null,null==n&&(n=x.asString(),n=n.startsWith(";base64,")?JU.Base64.decodeBase64(n):n.getBytes()),j.equals("_DATA_")){a=
null;null==n&&(n=x.value.data);break}else j.equals("_IMAGE_")?(a.add(0,j),a.add(1,null),a.add(2,n)):(a.addLast(j),a.addLast(null),a.addLast(n));null==a?null==n&&(l=s.asString(),h="TXT"):null!=f&&null==(n=l=this.vwr.createZip(f,1==a.size()?"BINARY":"ZIPDATA",a))&&d.evalError("#CANCELED#",null)}else if("SPT"===l)if(q)D=this.vwr.ms.getTaintedAtoms(2),this.vwr.setAtomCoordsRelative(JU.P3.new3(0,0,0),null),l=this.vwr.getStateInfo(),this.vwr.ms.setTaintedAtoms(D,2);else{if(l=this.vwr.getStateInfo(),null!=
g||null!=j)l=JV.FileManager.setScriptFileReferences(l,g,j,null)}else"ZIP"===l||"ZIPALL"===l?null!=f&&null==(n=l=this.vwr.createZip(f,h,e))&&d.evalError("#CANCELED#",null):"HISTORY"===l?(l=this.vwr.getSetHistory(2147483647),h="SPT"):"MO"===l||"NBO"===l?(l=this.getMoJvxl(2147483647,"NBO"===l),h="XJVXL"):"PMESH"===l?(null==(l=this.getIsosurfaceJvxl(!0,29))&&this.error(31),h="XJVXL"):"ISOSURFACE"===l||"MESH"===l?(null==(l=this.getIsosurfaceJvxl("MESH"===l,24))&&this.error(31),h=0<=l.indexOf("<?xml")?
"XJVXL":"JVXL",m||this.showString(this.getShapeProperty(24,"jvxlFileInfo"))):(k&&(m&&null==f)&&(m=!1,f="\u0001"),u=-1,0>p&&(p=-1));null==l&&(l="");0==u&&(null==n||H(n,String))}if(!k)return l;if(m)return d.showStringPrint(l,!0),"";if(null!=n&&H(n,String))return this.writeMsg(n);if(v)return this.writeMsg(this.vwr.writeFileData(f,h,0,null));if(h.equals("SCENE"))n=y;else if(null==n&&(!t||null!=f))n=l;b&&JU.Logger.startTimer("write");t&&(d.refresh(!1),0>w&&(w=this.vwr.getScreenWidth()),0>r&&(r=this.vwr.getScreenHeight()));
m=new java.util.Hashtable;null!=f&&m.put("fileName",f);m.put("backgroundColor",Integer.$valueOf(this.vwr.getBackgroundArgb()));m.put("type",h);H(n,String)&&-2147483648==p?m.put("text",n):H(n,Array)&&m.put("bytes",n);null!=e&&m.put("scripts",e);null!=z&&m.put("bsFrames",z);m.put("fullPath",c);m.put("quality",Integer.$valueOf(p));m.put("width",Integer.$valueOf(w));m.put("height",Integer.$valueOf(r));m.put("nVibes",Integer.$valueOf(B));f=this.vwr.processWriteOrCapture(m);null==f&&(f="canceled");t&&f.startsWith("OK")&&
(f+="; width="+w+"; height="+r);b&&this.showString(JU.Logger.getTimerMsg("write",0));return this.writeMsg(f)},"~A");k(c$,"writeMsg",function(a){if(this.chk||null==a)return"";a.startsWith("OK")||(this.e.evalError(a,null),alert(a));this.e.report(a);return a},"~S");k(c$,"show",function(){var a=this.e,d=null,c=this.paramAsStr(1),b=null,e=null,f=2,e=this.getToken(1),g=H(e,JS.SV)?0:e.tok;4==g&&(e=JS.T.getTokenFromName(c.toLowerCase()),null!=e&&(g=e.tok));1297090050!=g&&(1073742158!=g&&1716520985!=g)&&this.checkLength(-3);
if(2==this.slen&&0<=c.indexOf("?"))this.showString(this.vwr.getAllSettings(c.substring(0,c.indexOf("?"))));else{switch(g){case 0:this.chk||(b=a.theToken.escape());break;case 1073741925:a.checkLength23();f=this.st.length;this.chk||(b=this.vwr.ms.getInfo(this.vwr.am.cmi,"domains"),b=H(b,JS.SV)?this.vwr.getAnnotationInfo(b,a.optParameterAsString(2),1073741925):"domain information has not been loaded");break;case 1716520985:b=this.plot(this.st);f=this.st.length;break;case 1073742189:a.checkLength23();
f=this.st.length;this.chk||(b=this.vwr.ms.getInfo(this.vwr.am.cmi,"validation"),b=H(b,JS.SV)?this.vwr.getAnnotationInfo(b,a.optParameterAsString(2),1073742189):"validation information has not been loaded");break;case 135270423:this.chk||(b=JU.Escape.e(this.vwr.fm.cacheList()));break;case 1073741916:a.checkLength23();f=this.st.length;this.chk||(b=this.vwr.ms.getInfo(this.vwr.am.cmi,"dssr"),b=null==b?"no DSSR information has been read":2<f?JS.SV.getVariable(this.vwr.extractProperty(b,this.stringParameter(2),
-1)).asString():""+JS.SV.getVariable(b).asString());break;case 1073741915:this.checkLength(2);this.chk||(b=this.vwr.calculateStructures(null,!0,!1));break;case 545259571:this.checkLength(2);this.chk||(b=this.vwr.fm.getPathForAllFiles());break;case 1073742038:if(a.optParameterAsString(2).equalsIgnoreCase("1H")){f=3;this.chk||(b=this.vwr.getNMRPredict(!1));break}this.chk||this.vwr.getNMRPredict(!0);return;case 1073741929:case 1073741879:case 135267336:this.checkLength(1073741879==g?3:2);if(this.chk)return;
try{135267336!=g&&(b=this.vwr.getDataBaseName(null)),b=null!=b&&(b.startsWith("$")||b.startsWith(":"))?b.substring(1):null,null==b&&(b=this.vwr.getSmiles(null))}catch(j){if(K(j,Exception))b=j.getMessage();else throw j;}switch(g){case 1073741929:if(0<b.length){this.vwr.fm.loadImage(this.vwr.setLoadFormat("_"+b,"2",!1),"\u0001"+b);return}b="Could not show drawing -- Either insufficient atoms are selected or the model is a PDB file.";break;case 1073741879:f=3,0<b.length?(b=this.vwr.getChemicalInfo(b,
this.getToken(2)),0<=b.indexOf("FileNotFound")&&(b="?")):b="Could not show name -- Either insufficient atoms are selected or the model is a PDB file."}break;case 1297090050:var g=0,h=e=null;3<this.slen&&4!=this.tokAt(3)?(e=this.centerParameter(2),h=this.centerParameter(++a.iToken)):g=2==this.tokAt(2)?this.intParameter(2):0;var k=4==this.tokAt(a.iToken+1)?this.stringParameter(++a.iToken):null;this.checkLength(f=++a.iToken);this.chk||(b=this.vwr.ms.getSymTemp(!0).getSymmetryInfoString(this.vwr.ms,this.vwr.am.cmi,
g,e,h,null,k));break;case 1649412120:a=null;2<this.slen&&(a=J.c.VDW.getVdwType(this.paramAsStr(2)),null==a&&this.invArg());this.chk||this.showString(this.vwr.getDefaultVdwNameOrData(0,a,null));return;case 135368713:a.checkLength23();this.chk||this.showString(this.vwr.getFunctionCalls(a.optParameterAsString(2)));return;case 1085443:this.checkLength(2);this.chk||this.showString(this.vwr.getAllSettings(null));return;case 1074790760:if(2==this.slen){this.chk||this.vwr.showUrl(a.getFullPathName());return}e=
this.paramAsStr(2);this.chk||this.vwr.showUrl(e);return;case 1766856708:c="defaultColorScheme";break;case 1610612740:c="scaleAngstromsPerInch";break;case 135270418:case 1052714:if(this.chk)return;0>this.vwr.am.cmi&&a.errorStr(30,"show "+a.theToken.value);b=this.plot(this.st);f=this.slen;break;case 14:case 1113200654:this.chk||(b=this.getContext(!1));break;case 1073741888:e=a.optParameterAsString(2);0<e.length&&(f=3);this.chk||(d=this.vwr.cm.getColorSchemeList(e));break;case 1073742192:this.chk||(b=
this.vwr.getAtomDefs(this.vwr.definedAtomSets)+this.vwr.g.getVariableList()+this.getContext(!0));break;case 536870926:this.chk||(b=this.vwr.getTrajectoryState());break;case 553648148:d=""+JS.ScriptEval.commandHistoryLevelMax;break;case 553648150:d=""+JU.Logger.getLogLevel();break;case 603979825:d=""+this.vwr.getBoolean(603979825);break;case 553648178:b="set strandCountForStrands "+this.vwr.getStrandCount(12)+"; set strandCountForMeshRibbon "+this.vwr.getStrandCount(13);break;case 536875070:b=this.vwr.showTimeout(2==
(f=this.slen)?null:this.paramAsStr(2));break;case 536870918:d=JU.Escape.eP(this.vwr.getDefaultLattice());break;case 4126:this.chk||(b=this.vwr.getMinimizationInfo());break;case 1611272194:switch(this.vwr.g.axesMode){case 603979808:b="set axesUnitcell";break;case 603979804:b="set axesMolecular";break;default:b="set axesWindow"}break;case 1610612737:b="set bondMode "+(this.vwr.getBoolean(603979812)?"OR":"AND");break;case 1650071565:this.chk||(b="set strandCountForStrands "+this.vwr.getStrandCount(12)+
"; set strandCountForMeshRibbon "+this.vwr.getStrandCount(13));break;case 1612189718:b="set hbondsBackbone "+this.vwr.getBoolean(603979852)+";set hbondsSolid "+this.vwr.getBoolean(603979854);break;case 1611141175:this.chk||(b=this.vwr.getSpinState());break;case 1611141176:b="set ssbondsBackbone "+this.vwr.getBoolean(603979952);break;case 1610625028:case 1611141171:b="selectionHalos "+(this.vwr.getSelectionHalosEnabled()?"ON":"OFF");break;case 1613758470:b="set selectHetero "+this.vwr.getBoolean(1613758470);
break;case 1073741828:b=JU.Escape.eAP(this.vwr.getAdditionalHydrogens(null,!0,!0,null));break;case 1613758476:b="set selectHydrogens "+this.vwr.getBoolean(1613758476);break;case 553648130:case 553648142:case 536870924:case 553648176:case 553648172:case 1073741995:this.chk||(b=this.vwr.getLightingState());break;case 1073742136:case 4146:this.chk||(b=this.vwr.stm.listSavedStates());break;case 1614417948:this.chk||(b=this.vwr.getUnitCellInfoText());break;case 1048581:if(2==(f=this.slen)){this.chk||(b=
this.vwr.getCoordinateState(this.vwr.bsA()));break}g=this.paramAsStr(2);this.chk||(b=this.vwr.stm.getSavedCoordinates(g));break;case 1073742158:!this.chk&&null==a.outputBuffer&&this.vwr.sm.clearConsole();if(2==(f=this.slen)){this.chk||(b=this.vwr.getStateInfo());break}e=this.paramAsStr(2);if(e.startsWith("/")&&3==(f=this.slen)){if(!this.chk){e=e.substring(1).toLowerCase();g=JU.PT.split(this.vwr.getStateInfo(),"\n");b=new JU.SB;for(h=0;h<g.length;h++)0<=g[h].toLowerCase().indexOf(e)&&b.append(g[h]).appendC("\n");
b=b.toString()}break}else if(1229984263==this.tokAt(2)&&4==(f=this.slen)){this.chk||(b=this.vwr.fm.getEmbeddedFileState(this.paramAsStr(3),!0));break}f=3;this.chk||(b=this.vwr.stm.getSavedState(e));break;case 1641025539:if(2==(f=this.slen)){this.chk||(b=this.vwr.ms.getProteinStructureState(this.vwr.bsA(),135270926));break}g=this.paramAsStr(2);this.chk||(b=this.vwr.stm.getSavedStructure(g));break;case 135270408:g=3==(f=this.slen)?this.paramAsStr(2):null;this.chk||(b=this.vwr.getData(g),b=null==b?"no data":
JU.Escape.encapsulateData(b[0],b[1],b[3].intValue()));break;case 1073742152:g=null;2==(f=this.slen)?this.chk||(g=this.vwr.ms.getSymTemp(!0).getSpaceGroupInfo(this.vwr.ms,null)):(e=this.paramAsStr(2),this.chk||(g=this.vwr.ms.getSymTemp(!0).getSpaceGroupInfo(this.vwr.ms,JU.PT.rep(e,"''",'"'))));null!=g&&(b=""+g.get("spaceGroupInfo")+g.get("symmetryInfo"));break;case 1048582:f=3;b=a.setObjectProperty();break;case 1679429641:this.chk||(b=this.vwr.ms.getBoundBoxCommand(!0));break;case 12289:this.chk||
(b="center "+JU.Escape.eP(this.vwr.tm.fixedRotationCenter));break;case 135176:this.chk||(b=this.getShapeProperty(22,"command"));break;case 1229984263:this.chk||this.vwr.sm.clearConsole();if(2==this.slen){this.chk||(b=this.vwr.getCurrentFileAsString("script"));null==b&&(b="<unavailable>");break}f=3;d=this.paramAsStr(2);this.chk||(b=this.vwr.getFileAsString3(d,!0,null));break;case 4115:b=1048579==this.tokAt(2)&&0<(f=3)?this.vwr.getModelFileInfoAll():this.vwr.getModelFileInfo();break;case 1610616855:g=
2==(f=this.slen)?2147483647:this.intParameter(2);1>g&&this.invArg();this.chk||(this.vwr.sm.clearConsole(),0==a.scriptLevel&&this.vwr.removeCommand(),b=this.vwr.getSetHistory(g));break;case 135180:this.chk||(b=this.getShapeProperty(24,"jvxlDataXml"));break;case 1073877011:case 1073877010:a.optParameterAsString(2).equalsIgnoreCase("list")?(this.e.sm.loadShape(27),b=this.chk?"":this.getShapeProperty(27,"list -1"),f=3):(e=2==(f=this.slen)?-2147483648:this.intParameter(2),this.chk||(b=this.getMoJvxl(e,
1073877011==g)));break;case 1095766030:this.chk||(b=this.vwr.ms.getModelInfoAsString());break;case 537006096:this.chk||(b=this.vwr.getMeasurementInfoAsString());break;case 1073741863:f=3;!this.chk&&this.slen==f&&(b=this.vwr.getOrientationText(this.tokAt(2),null));break;case 1073742132:g=this.tokAt(2),0==g?g=1073742132:f=3;case 1073742178:case 4129:this.chk||(b=this.vwr.getOrientationText(g,null));break;case 1073742077:f=2;if(3<this.slen)break;switch(g=this.tokAt(2)){case 1073742178:case 1073742132:case 4129:case 0:this.chk||
(b=this.vwr.getOrientationText(g,null));break;default:e=a.optParameterAsString(2),b=this.vwr.getOrientationText(1073742035,e)}f=this.slen;break;case 1073742088:this.chk||(b=this.vwr.ms.getPDBHeader(this.vwr.am.cmi));break;case 1073742102:this.chk||this.showString(this.vwr.ms.getPointGroupAsString(this.vwr.bsA(),!1,null,0,0));return;case 1089470478:this.chk||(b=this.vwr.ms.getSymmetryInfoAsString());break;case 1073742176:this.chk||(b="transform:\n"+this.vwr.tm.matrixRotate.toString());break;case 4168:b=
"zoom "+(this.vwr.tm.zoomEnabled?""+this.vwr.tm.getZoomSetting():"off");break;case 1611272202:b=this.vwr.getShowFrank()?"frank ON":"frank OFF";break;case 1666189314:c="solventProbeRadius";break;case 1087373320:if(3==(f=this.slen)&&1048588==this.tokAt(2))g=1087373319;case 1073741864:case 1087373316:case 1073742120:case 1114638363:case 1087373318:case 1141899265:case 1073741982:this.chk||(b=this.vwr.getChimeInfo(g));break;case 537022465:case 1610612738:case 20482:case 1613758488:d="?";break;case 1073742031:g=
2==(f=this.slen)?null:this.paramAsStr(2);this.chk||(b=this.vwr.getBindingInfo(g));break;case 1073742015:this.chk||(d=this.vwr.getMenu(""));break;case 1073741824:c.equalsIgnoreCase("fileHeader")&&(this.chk||(b=this.vwr.ms.getPDBHeader(this.vwr.am.cmi)));break;case 1073741992:case 36868:c=this.paramAsStr(f++),e=a.getParameter(c,1073742190,!0),this.chk||(b=1073741992==g?e.toJSON():e.escape())}this.checkLength(f);this.chk||(null!=b?this.showString(b):null!=d?this.showString(c+" = "+d):null!=c&&(0<=c.indexOf(" ")?
this.showString(c):this.showString(c+" = "+a.getParameter(c,1073742190,!0).escape())))}});k(c$,"stereo",function(){for(var a=J.c.STER.DOUBLE,d=-5,c=!1,b=null,e=0,f=1;f<this.slen;++f)if(this.e.isColorParam(f))1<e&&this.e.bad(),0==e&&(b=F(2,0)),c||(d=3),b[e]=this.e.getArgbParam(f),0==e++&&(b[1]=~b[0]),f=this.e.iToken;else switch(this.getToken(f).tok){case 1048589:this.e.checkLast(this.e.iToken=1);this.e.iToken=1;break;case 1048588:this.e.checkLast(this.e.iToken=1);a=J.c.STER.NONE;break;case 2:case 3:d=
this.floatParameter(f);c=!0;break;case 1073741824:if(c||(d=3),a=J.c.STER.getStereoMode(this.paramAsStr(f)),null!=a)break;default:this.invArg()}this.chk||this.vwr.setStereoMode(b,a,d)});k(c$,"struts",function(){var a=this.e,d=1073742072==this.tokAt(1)||1048589==this.tokAt(1)||1==this.slen,c=a.getMadParameter();if(2147483647==c)return!1;d&&(c=Math.round(2E3*this.vwr.getFloat(570425406)));this.setShapeProperty(1,"type",Integer.$valueOf(32768));a.setShapeSizeBs(1,c,null);this.setShapeProperty(1,"type",
Integer.$valueOf(1023));return!0});k(c$,"unitcell",function(a){var d=this.e,c=2147483647,b=2147483647,e=null,f=d.tickParamAsStr(a,!0,!1,!1);a=d.iToken;var g=null,j=null,h=null,k=null,m=b=!1;switch(this.tokAt(++a)){case 4142:case 4141:m=!0;e=JU.P4.new4(0,0,0,-1);d.iToken++;break;case 4:case 1073741824:k=b=this.paramAsStr(a).toLowerCase();0>b.indexOf(",")&&!this.chk&&(d.setCurrentCagePts(null,null),JU.PT.isOneOf(b,";parent;standard;primitive;")&&(h=this.vwr.ms.getInfo(this.vwr.am.cmi,"unitcell_conventional"),
null!=h&&d.setCurrentCagePts(this.vwr.getV0abc(h),""+h)),b=this.vwr.ms.getInfo(this.vwr.am.cmi,"unitcell_"+b),this.showString(b));h=b;break;case 135180:case 1048582:g=d.objectNameParameter(++a);break;case 1679429641:j=JU.P3.newP(this.vwr.getBoundBoxCenter());e=this.vwr.getBoundBoxCornerVector();j.sub(e);j=z(-1,[j,JU.P3.new3(2*e.x,0,0),JU.P3.new3(0,2*e.y,0),JU.P3.new3(0,0,2*e.z)]);e=null;d.iToken=a;break;case 11:case 12:h=this.getToken(a).value;break;case 12289:switch(this.tokAt(++a)){case 10:case 1048577:e=
JU.P3.newP(this.vwr.ms.getAtomSetCenter(this.atomExpressionAt(a)));this.vwr.toFractional(e,!0);a=d.iToken;break;default:if(d.isCenterParameter(a)){e=this.centerParameter(a);a=d.iToken;break}this.invArg()}e.x-=0.5;e.y-=0.5;e.z-=0.5;break;case 10:case 1048577:a=this.atomExpressionAt(a).nextSetBit(0);this.chk||(this.vwr.am.cai=a);if(0>a)return;a=d.iToken;break;case 1073742066:b=!0;case 1073742114:e=d.getPointOrPlane(++a,!1,!0,!1,!0,3,3);e=JU.P4.new4(e.x,e.y,e.z,b?1:0);a=d.iToken;break;case 3:case 2:if(111>
this.floatParameter(a)){a--;break}c=this.intParameter(a);break;default:d.isArrayParameter(a)?(j=d.getPointArray(a,4,!1),a=d.iToken):this.slen>a+1?(e=d.getPointOrPlane(a,!1,!0,!1,!0,3,3),a=d.iToken):a--}b=d.getSetAxesTypeMad(++a);d.checkLast(d.iToken);this.chk||2147483647==b||(2147483647==b&&(this.vwr.am.cai=-1),null!=h&&(j=this.vwr.getV0abc(h)),2147483647!=c?this.vwr.ms.setUnitCellOffset(this.vwr.getCurrentUnitCell(),null,c):null!=g?this.vwr.setCurrentCage(g):(m||null!=j)&&d.setCurrentCagePts(j,k),
d.setObjectMad(33,"unitCell",b),null!=e&&this.vwr.ms.setUnitCellOffset(this.vwr.getCurrentUnitCell(),e,0),null!=f&&this.setShapeProperty(33,"tickInfo",f))},"~N");k(c$,"assign",function(){var a=this.tokAt(1),d=this.atomExpressionAt(2).nextSetBit(0),c=-1,b=null;if(!(0>d)){4106==a?c=this.atomExpressionAt(++this.e.iToken).nextSetBit(0):b=this.paramAsStr(++this.e.iToken);var e=++this.e.iToken<this.slen?this.centerParameter(this.e.iToken):null;if(!this.chk)switch(a){case 1141899265:this.e.clearDefinedVariableAtomSets();
this.assignAtom(d,e,b);break;case 1678770178:this.assignBond(d,(b+"p").charAt(0));break;case 4106:this.assignConnect(d,c)}}});k(c$,"assignAtom",function(a,d,c){c.equals("X")&&this.vwr.setRotateBondIndex(-1);if(this.vwr.ms.at[a].mi==this.vwr.ms.mc-1){this.vwr.clearModelDependentObjects();var b=this.vwr.ms.ac;if(null==d)this.vwr.sm.modifySend(a,this.vwr.ms.at[a].mi,1,this.e.fullCommand),this.vwr.ms.assignAtom(a,c,!0),JU.PT.isOneOf(c,";Mi;Pl;X;")||this.vwr.ms.setAtomNamesAndNumbers(a,-b,null),this.vwr.sm.modifySend(a,
this.vwr.ms.at[a].mi,-1,"OK"),this.vwr.refresh(3,"assignAtom");else{var e=this.vwr.ms.at[a],f=JU.BSUtil.newAndSetBit(a);d=z(-1,[d]);var g=new JU.Lst;g.addLast(e);e=e.mi;this.vwr.sm.modifySend(a,e,3,this.e.fullCommand);try{f=this.vwr.addHydrogensInline(f,g,d),a=f.nextSetBit(0),this.vwr.ms.assignAtom(a,c,!1)}catch(j){if(!K(j,Exception))throw j;}this.vwr.ms.setAtomNamesAndNumbers(a,-b,null);this.vwr.sm.modifySend(a,e,-3,"OK")}}},"~N,JU.P3,~S");k(c$,"assignBond",function(a,d){var c=-1;try{c=this.vwr.ms.bo[a].atom1.mi;
this.vwr.sm.modifySend(a,c,2,this.e.fullCommand);var b=this.vwr.ms.setBondOrder(a,d);null==b||"0"==d?this.vwr.refresh(3,"setBondOrder"):this.vwr.addHydrogens(b,!1,!0);this.vwr.sm.modifySend(a,c,-2,""+d)}catch(e){if(K(e,Exception))JU.Logger.error("assignBond failed"),this.vwr.sm.modifySend(a,c,-2,"ERROR "+e);else throw e;}},"~N,~S");k(c$,"assignConnect",function(a,d){this.vwr.clearModelDependentObjects();var c=JU.AU.newFloat2(1);c[0]=L(-1,[a,d]);var b=this.vwr.ms.at[a].mi;this.vwr.sm.modifySend(a,
b,2,this.e.fullCommand);this.vwr.ms.connect(c);this.vwr.ms.assignAtom(a,".",!0);this.vwr.ms.assignAtom(d,".",!0);this.vwr.sm.modifySend(a,b,-2,"OK");this.vwr.refresh(3,"assignConnect")},"~N,~N");k(c$,"getContext",function(a){for(var d=new JU.SB,c=this.e.thisContext;null!=c;)a?null!=c.vars&&(d.append(this.getScriptID(c)),d.append(JV.StateManager.getVariableList(c.vars,80,!0,!1))):d.append(JS.ScriptError.getErrorLineMessage(c.functionName,c.scriptFileName,this.e.getLinenumber(c),c.pc,JS.ScriptEval.statementAsString(this.vwr,
c.statement,-9999,this.e.debugHigh))),c=c.parentContext;a?null!=this.e.contextVariables&&(d.append(this.getScriptID(null)),d.append(JV.StateManager.getVariableList(this.e.contextVariables,80,!0,!1))):d.append(this.e.getErrorLineMessage2());return d.toString()},"~B");k(c$,"getIsosurfaceJvxl",function(a,d){return this.chk?"":this.getShapeProperty(d,a?"jvxlMeshX":"jvxlDataXml")},"~B,~N");k(c$,"getMoJvxl",function(a,d){var c=d?28:27;this.e.sm.loadShape(c);var b=this.vwr.am.cmi;0>b&&this.e.errorStr(30,
"show/write MO/NBO");var e=this.vwr.ms.getInfo(b,"moData");null==e&&this.error(27);var f=this.getShapeProperty(c,"moNumber");(null==f||0==f.intValue())&&this.setShapeProperty(c,"init",Integer.$valueOf(b));this.setShapeProperty(c,"moData",e);return this.getShapePropertyIndex(c,"showMO",a)},"~N,~B");k(c$,"getScriptID",function(a){return"\n# "+(null==a?this.e.functionName:"function "+a.functionName)+" (file "+(null==a?this.e.scriptFileName:a.scriptFileName)+(null==a?"":" context "+a.id)+")\n"},"JS.ScriptContext");
k(c$,"getShapePropertyIndex",function(a,d,c){return this.e.sm.getShapePropertyIndex(a,d,c)},"~N,~S,~N");k(c$,"tokenAt",function(a,d){return a<d.length?d[a]:null},"~N,~A");c$.tokAtArray=k(c$,"tokAtArray",function(a,d){return a<d.length&&null!=d[a]?d[a].tok:0},"~N,~A");k(c$,"getPlotMinMax",function(a,d,c){if(null==a)return 0;switch(c){case 1112539144:case 1112539145:case 1112539146:return d?180:-180;case 1112539141:case 1112539152:return d?360:0;case 1112539150:return d?1:-1}c=d?-1E10:1E10;for(var b=
a.length;0<=--b;){var e=a[b];Float.isNaN(e)||d==e>c&&(c=e)}return c},"~A,~B,~N");k(c$,"parseDataArray",function(a,d){a=JU.Parser.fixDataString(a);var c=JU.Parser.markLines(a,"\n"),b=c.length;if(!d){for(var e=JU.AU.newFloat2(b),f=0,g=0;f<b;g=c[f++])g=JU.PT.getTokens(a.substring(g,c[f])),JU.PT.parseFloatArrayData(g,e[f]=L(g.length,0));return e}g=JU.PT.getTokens(a.substring(0,c[0]));if(3!=g.length)return L(0,0,0,0);var j=JU.PT.parseInt(g[0]),h=JU.PT.parseInt(g[1]),k=JU.PT.parseInt(g[2]);if(1>j||1>h||
1>k)return L(1,1,1,0);for(var e=JU.AU.newFloat3(j,h),m=0,p=0,f=1,g=c[0];f<b&&m<j;g=c[f++])g=JU.PT.getTokens(a.substring(g,c[f])),g.length<k||(JU.PT.parseFloatArrayData(g,e[m][p]=L(g.length,0)),++p==h&&(m++,p=0));return m!=j?(System.out.println("Error reading 3D data -- nX = "+j+", but only "+m+" blocks read"),L(1,1,1,0)):e},"~S,~B");U(c$,"ERROR_invalidArgument",22)})})(Clazz,Clazz.newLongArray,Clazz.doubleToByte,Clazz.doubleToInt,Clazz.doubleToLong,Clazz.declarePackage,Clazz.instanceOf,Clazz.load,
Clazz.instantialize,Clazz.decorateAsClass,Clazz.floatToInt,Clazz.floatToLong,Clazz.makeConstructor,Clazz.defineEnumConstant,Clazz.exceptionOf,Clazz.newIntArray,Clazz.defineStatics,Clazz.newFloatArray,Clazz.declareType,Clazz.prepareFields,Clazz.superConstructor,Clazz.newByteArray,Clazz.declareInterface,Clazz.p0p,Clazz.pu$h,Clazz.newShortArray,Clazz.innerTypeInstance,Clazz.isClassDefined,Clazz.prepareCallback,Clazz.newArray,Clazz.castNullAs,Clazz.floatToShort,Clazz.superCall,Clazz.decorateAsType,Clazz.newBooleanArray,
Clazz.newCharArray,Clazz.implementOf,Clazz.newDoubleArray,Clazz.overrideConstructor,Clazz.clone,Clazz.doubleToShort,Clazz.getInheritedLevel,Clazz.getParamsType,Clazz.isAF,Clazz.isAI,Clazz.isAS,Clazz.isASS,Clazz.isAP,Clazz.isAFloat,Clazz.isAII,Clazz.isAFF,Clazz.isAFFF,Clazz.tryToSearchAndExecute,Clazz.getStackTrace,Clazz.inheritArgs,Clazz.alert,Clazz.defineMethod,Clazz.overrideMethod,Clazz.declareAnonymous,Clazz.cloneFinals);
